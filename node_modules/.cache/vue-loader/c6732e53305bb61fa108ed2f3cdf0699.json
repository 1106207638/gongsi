{"remainingRequest":"D:\\vue\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\vue\\src\\views\\online\\modules\\selfcgreportModule.vue?vue&type=style&index=0&id=563844ec&scoped=true&lang=css&","dependencies":[{"path":"D:\\vue\\src\\views\\online\\modules\\selfcgreportModule.vue","mtime":1616038591485},{"path":"D:\\vue\\node_modules\\@vue\\cli-service\\node_modules\\css-loader\\dist\\cjs.js","mtime":1615952641773},{"path":"D:\\vue\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1615952643260},{"path":"D:\\vue\\node_modules\\postcss-loader\\src\\index.js","mtime":1615952643158},{"path":"D:\\vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1615952641464},{"path":"D:\\vue\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader\\lib\\index.js","mtime":1615952643260}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLmZvcm0taXRlbSB7CiAgbWFyZ2luLWxlZnQ6IDE1cHgKfQoKL2RlZXAvIC5hbnQtZm9ybSAuYW50LWZvcm0taXRlbSB7CiAgbWFyZ2luLWJvdHRvbTogMDsKfQoKL2RlZXAvIC5mb3JtLWl0ZW0gewogIG1hcmdpbi1sZWZ0OiAwOwp9CgovZGVlcC8gLmFudC1mb3JtID4gLmFudC1yb3cgewogIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZThlOGU4OwogIHBhZGRpbmc6IDEycHggMDsKfQoKL2RlZXAvIC5hbnQtZm9ybSBsYWJlbCB7CiAgZm9udC1zaXplOiAxMnB4Owp9Ci9kZWVwLy50b290bGUgLmFudC10b29sdGlwLWlubmVyIHsKICBiYWNrZ3JvdW5kOiAjZmZmOwp9Cg=="},{"version":3,"sources":["selfcgreportModule.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6mBA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"selfcgreportModule.vue","sourceRoot":"src/views/online/modules","sourcesContent":["  <template>\r\n    <j-modal\r\n        :title=\"title\"\r\n        :width=\"width\"\r\n        :visible=\"visible\"\r\n        :fullscreen=\"true\"\r\n        :confirmLoading=\"confirmLoading\"\r\n        switchFullscreen\r\n        @ok=\"handleOk\"\r\n        @cancel=\"handleCancel\"\r\n        cancelText=\"关闭\">\r\n      <a-spin :spinning=\"confirmLoading\">\r\n        <a-form :form=\"form\">\r\n          <a-row :gutter=\"24\">\r\n            <a-col :xl=\"8\" :lg=\"8\" :md=\"8\" :sm=\"8\">\r\n              <a-form-item label=\"编码\" :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\">\r\n                <a-input v-decorator=\"['code',{\r\n                   rules: [{ required: true, message: '请输入编码' },{\r\n                    validator: compareToFirstPassword,\r\n                   }]\r\n                }]\"></a-input>\r\n              </a-form-item>\r\n            </a-col>\r\n            <a-col :xl=\"8\" :lg=\"8\" :md=\"8\" :sm=\"8\">\r\n              <a-form-item label=\"名称\" :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\">\r\n                <a-input v-decorator=\"['name',{\r\n                   rules: [{ required: true, message: '请输入报表名称' }]\r\n                }]\" placeholder=\"请输入表名称\"></a-input>\r\n              </a-form-item>\r\n            </a-col>\r\n            <a-col :xl=\"8\" :lg=\"8\" :md=\"8\" :sm=\"8\">\r\n              <a-form-item label=\"数据源\" :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\">\r\n                <a-select v-decorator=\"['dbSource',{}]\" >\r\n                  <a-select-option :value=\"item.value\" v-for=\"(item,index) in sqlType\" :key=\"index\">\r\n                    {{item.text}}\r\n                  </a-select-option>\r\n                </a-select>\r\n              </a-form-item>\r\n            </a-col>\r\n          </a-row>\r\n          <a-row :gutter=\"24\">\r\n            <a-col :xl=\"21\" :lg=\"21\" :md=\"21\" :sm=\"21\">\r\n            <a-form-item label=\"报表SQL\" :labelCol=\"labelCol1\" :wrapperCol=\"wrapperCol1\">\r\n              <j-code-editor\r\n                  :sqlValue=\"sqlValue\"\r\n                  language=\"sql\"\r\n                  v-decorator=\"['cgrSql',{initialValue: sqlValue ,\r\n                   rules: [{ required: true, message: '请输入SQL语句' }]}]\"\r\n                  @input=\"getValue\"\r\n                  :fullScreen=\"true\"\r\n                  style=\"min-height: 100px\"/>\r\n            </a-form-item>\r\n            </a-col>\r\n            <a-col :xl=\"3\" :lg=\"3\" :md=\"3\" :sm=\"3\">\r\n              <a-tooltip placement=\"bottom\" title=\" 您可以键入“”作为一个参数，这里abc是参数的名称。例如：<br>\r\n          select * from table where id = ${abc}。<br>\r\n          select * from table where id like concat('%',${abc},'%')。(mysql模糊查询)<br>\r\n          select * from table where id like '%'||${abc}||'%'。(oracle模糊查询)<br>\r\n          select * from table where id like '%'+${abc}+'%'。(sqlserver模糊查询)<br>\r\n          注：参数只支持动态报表，popup暂不支持\" overlayClassName=\"tootle\">\r\n                <a-icon type=\"question-circle\" />\r\n              </a-tooltip>\r\n\r\n              <a-button type=\"primary\" @click=\"sqlsend\" style=\"margin-left: 20px\">\r\n                SQL解析\r\n              </a-button>\r\n            </a-col>\r\n          </a-row>\r\n        </a-form>\r\n        <a-tabs default-active-key=\"1\" @change=\"callback\">\r\n          <a-tab-pane key=\"1\" tab=\"动态报表配置明细\">\r\n            <div style=\"margin: 10px 0\">\r\n              <a-button  icon=\"plus\" @click=\"selfadd\" type=\"primary\">新增</a-button>\r\n              <template v-if=\"selectedRowIds.length > 0\">\r\n                <a-popconfirm\r\n                    :title=\"`确定要删除这 ${selectedRowIds.length} 项吗?`\"\r\n                    @confirm=\"remove\"\r\n                >\r\n                  <a-button icon=\"minus\" >删除</a-button>\r\n                </a-popconfirm>\r\n                <!--              <template >-->\r\n                <!--                <a-button icon=\"delete\" @click=\"trigger('clearSelection')\">清空选择</a-button>-->\r\n                <!--              </template>-->\r\n              </template>\r\n            </div>\r\n\r\n            <j-demo :columns=\"columns1\" ref=\"demo1\" @ok1=\"ok1\" @editsave=\"saveEdit\"  :datas=\"fields\" @handlerRows=\"selectRows\" :toolbar=\"false\" :isonline=\"true\" :issort=\"true\"></j-demo>\r\n          </a-tab-pane>\r\n  <!--        <a-tab-pane key=\"2\" tab=\"报表参数\" force-render>-->\r\n  <!--          <div style=\"margin: 10px 0\">-->\r\n  <!--            <a-button  icon=\"plus\" @click=\"paramsadd\" type=\"primary\">新增</a-button>-->\r\n  <!--            <template v-if=\"selectedRowIds.length > 0\">-->\r\n  <!--              <a-popconfirm-->\r\n  <!--                  :title=\"`确定要删除这 ${selectedRowIds.length} 项吗?`\"-->\r\n  <!--                  @confirm=\"removeparams\"-->\r\n  <!--              >-->\r\n  <!--                <a-button icon=\"minus\" >删除</a-button>-->\r\n  <!--              </a-popconfirm>-->\r\n  <!--              &lt;!&ndash;              <template >&ndash;&gt;-->\r\n  <!--              &lt;!&ndash;                <a-button icon=\"delete\" @click=\"trigger('clearSelection')\">清空选择</a-button>&ndash;&gt;-->\r\n  <!--              &lt;!&ndash;              </template>&ndash;&gt;-->\r\n  <!--            </template>-->\r\n  <!--          </div>-->\r\n\r\n  <!--          <j-demo :columns=\"columns2\" ref=\"demo2\" @ok1=\"ok2\" :datas=\"params\" @editsave=\"saveEditparams\" @handlerRows=\"selectRows\" :toolbar=\"false\" :issort=\"true\"></j-demo>-->\r\n\r\n  <!--        </a-tab-pane>-->\r\n        </a-tabs>\r\n\r\n        <div>\r\n        </div>\r\n        <template slot=\"content\">\r\n          您可以键入“”作为一个参数，这里abc是参数的名称。例如：\r\n          select * from table where id = ${abc}。\r\n          select * from table where id like concat('%',${abc},'%')。(mysql模糊查询)\r\n          select * from table where id like '%'||${abc}||'%'。(oracle模糊查询)\r\n          select * from table where id like '%'+${abc}+'%'。(sqlserver模糊查询)\r\n          注：参数只支持动态报表，popup暂不支持\r\n        </template>\r\n      </a-spin>\r\n    </j-modal>\r\n\r\n  </template>\r\n\r\n  <script>\r\n\r\n  import {getAction, httpAction} from '@/api/manage'\r\n  import pick from 'lodash.pick'\r\n  import {validateDuplicateValue} from '@/utils/util'\r\n  import JDictSelectTag from \"@/components/dict/JDictSelectTag\"\r\n  import {JVXETypes} from \"@comp/jeecg/JVxeTable\";\r\n  import JCodeEditor from '@/components/jeecg/JCodeEditor'\r\n  import JDemo from './jform.vue';\r\n\r\n  export default {\r\n    name: \"selfcgreportModule\",\r\n    components: {\r\n      JDictSelectTag,\r\n      JDemo,\r\n      JCodeEditor\r\n    },\r\n    prop: {\r\n      taskId: {\r\n        type: String,\r\n        required: true,\r\n      }\r\n    },\r\n    data() {\r\n      return {\r\n        isTrue1:false,\r\n        isTrue2:false,\r\n        rules: {\r\n          desc: [{ required: true, message: '请输入SQL语句', trigger: 'blur' }],\r\n        },\r\n        sqlValue:'',\r\n        id:'',\r\n        // 选中的行数\r\n        selectedRowIds:[],\r\n        jcodedditor: {\r\n          value: `function sayHi(word) {\r\n    alert(word)\r\n  }\r\n  sayHi('hello, world!')`\r\n        },\r\n        staticStyle: {\r\n          color: \"red\"\r\n        },\r\n        columns1: [{\r\n          title: \"字段名\",\r\n          width: \"150px\",\r\n          key: \"fieldName\",\r\n          type: JVXETypes.input,\r\n          defaultValue: \"\",\r\n          placeholder: \"请输入${title}\",\r\n          validateRules: [{\r\n            required: !0,\r\n            message: \"${title}不能为空\"\r\n          }]\r\n        },\r\n          {\r\n            title: \"字段文本\",\r\n            width: \"200px\",\r\n            key: \"fieldTxt\",\r\n            type: JVXETypes.input,\r\n            placeholder: \"请输入${title}\",\r\n            defaultValue: \"\",\r\n            validateRules: [{\r\n              required: !0,\r\n              message: \"${title}不能为空\"\r\n            }]\r\n          },\r\n          {\r\n            title: \"类型\",\r\n            width: \"150px\",\r\n            key: \"fieldType\",\r\n            type: JVXETypes.select,\r\n            options: [{\r\n              title: \"数值类型\",\r\n              value: \"Integer\"\r\n            },\r\n              {\r\n                title: \"字符类型\",\r\n                value: \"String\"\r\n              },\r\n              {\r\n                title: \"日期类型\",\r\n                value: \"Date\"\r\n              },\r\n              {\r\n                title: \"时间类型\",\r\n                value: \"Datetime\"\r\n              },\r\n              {\r\n                title: \"长整型\",\r\n                value: \"Long\"\r\n              }],\r\n            defaultValue: \"String\",\r\n            placeholder: \"请选择${title}\",\r\n            validateRules: [{\r\n              required: !0,\r\n              message: \"${title}不能为空\"\r\n            }]\r\n          },\r\n          {\r\n            title: \"是否显示\",\r\n            width: \"100px\",\r\n            key: \"isShow\",\r\n            type: JVXETypes.checkbox,\r\n            customValue: [1, 0],\r\n            defaultChecked: !0\r\n          },\r\n          {\r\n            title: \"值\",\r\n            Width: \"100px\",\r\n            key: \"value\",\r\n            type: JVXETypes.input,\r\n            defaultValue: \"\",\r\n            placeholder: \"请输入${title}\"\r\n          },\r\n        //   {\r\n        //     title: \"查询模式\",\r\n        //     width: \"150px\",\r\n        //     key: \"searchMode\",\r\n        //     type: JVXETypes.select,\r\n        //     options: [{\r\n        //       title: \"单条件查询\",\r\n        //       value: \"single\"\r\n        //     },\r\n        //       {\r\n        //         title: \"范围查询\",\r\n        //         value: \"group\"\r\n        //       }],\r\n        //     defaultValue: \"\",\r\n        //     placeholder: \"请选择${title}\"\r\n        //   },\r\n        //   {\r\n        //     title: \"取值表达式\",\r\n        //     width: \"160px\",\r\n        //     key: \"replaceVal\",\r\n        //     type: JVXETypes.input,\r\n        //     defaultValue: \"\",\r\n        //     placeholder: \"请输入${title}\"\r\n        //   },\r\n        //   {\r\n        //     title: \"字典code\",\r\n        //     width: \"200px\",\r\n        //     key: \"dictCode\",\r\n        //     type: JVXETypes.input,\r\n        //     defaultValue: \"\",\r\n        //     placeholder: \"请输入${title}\"\r\n        //   },\r\n        //   {\r\n        //     title: \"分组标题\",\r\n        //     width: \"200px\",\r\n        //     key: \"groupTitle\",\r\n        //     type: JVXETypes.input,\r\n        //     defaultValue: \"\",\r\n        //     placeholder: \"请输入${title}\"\r\n        //   },\r\n        //   {\r\n        //     title: \"是否查询\",\r\n        //     width: \"100px\",\r\n        //     key: \"isSearch\",\r\n        //     type: JVXETypes.checkbox,\r\n        //     customValue: [\"1\", \"0\"],\r\n        //     defaultChecked: !1\r\n        //   },\r\n        //   {\r\n        //     title: \"合计\",\r\n        //     width: \"100px\",\r\n        //     key: \"isTotal\",\r\n        //     type: JVXETypes.checkbox,\r\n        //     customValue: [\"1\", \"0\"],\r\n        //     defaultChecked: !1\r\n        //   }],\r\n        // columns2: [{\r\n        //   width: \"23%\",\r\n        //   title: \"参数\",\r\n        //   key: \"paramName\",\r\n        //   type: JVXETypes.input,\r\n        //   defaultValue: \"\",\r\n        //   placeholder: \"请输入${title}\",\r\n        //   validateRules: [{\r\n        //     required: !0,\r\n        //     message: \"${title}不能为空\"\r\n        //   }]\r\n        // },\r\n        //   {\r\n        //     width: \"23%\",\r\n        //     title: \"参数文本\",\r\n        //     key: \"paramTxt\",\r\n        //     type: JVXETypes.input,\r\n        //     defaultValue: \"\",\r\n        //     placeholder: \"请输入${title}\",\r\n        //     validateRules: [{\r\n        //       required: !0,\r\n        //       message: \"${title}不能为空\"\r\n        //     }]\r\n        //   },\r\n        //   {\r\n        //     width: \"23%\",\r\n        //     title: \"默认值\",\r\n        //     key: \"paramValue\",\r\n        //     type: JVXETypes.input,\r\n        //     defaultValue: \"\",\r\n        //     placeholder: \"请输入${title}\"\r\n        //   }\r\n        ],\r\n        form: this.$form.createForm(this),\r\n        title: \"操作\",\r\n        width: 1200,\r\n        visible: false,\r\n        model: {},\r\n        labelCol: {\r\n          xs: {span: 24},\r\n          sm: {span: 5},\r\n        },\r\n        wrapperCol: {\r\n          xs: {span: 24},\r\n          sm: {span: 16},\r\n        },\r\n        labelCol1: {\r\n          xs: {span: 24},\r\n          sm: {span: 2},\r\n        },\r\n        wrapperCol1: {\r\n          xs: {span: 24},\r\n          sm: {span: 22},\r\n        },\r\n        confirmLoading: false,\r\n        validatorRules: {},\r\n        url: {\r\n          add: \"online/cgreport/head/add\",\r\n          edit:'online/cgreport/head/editAll',\r\n          fieldUrl:'online/cgform/field/listByHeadId',\r\n          yanzheng:'/sys/duplicate/check',\r\n          sqlsend:'OnlCgreportController/parsesql',\r\n          sqlType:'/sys/dataSource/options',\r\n          head:'/online/cgreport/item/listByHeadId',\r\n          param:'/online/cgreport/param/listByHeadId'\r\n        },\r\n        fields:[],\r\n        params:[],\r\n        sqlType:[]\r\n      }\r\n    },\r\n    created() {\r\n        this.getsqlType()\r\n    },\r\n    methods: {\r\n      ok1() {\r\n        this.isTrue1 = res\r\n      },\r\n      ok2() {\r\n        this.isTrue2 = res\r\n      },\r\n      sqlsend() {\r\n        var code = this.form.getFieldValue('cgrSql')\r\n        if(code == '') {\r\n          this.$message.warning('请输入SQL语句');\r\n        }else{\r\n          var obj = {\r\n            sql : code\r\n          }\r\n          getAction(this.url.sqlsend, obj).then((res) => {\r\n            console.log(res)\r\n            if (res.success) {\r\n              this.fields = res.result.fields\r\n              this.params = res.result.params\r\n            } else {\r\n              this.$message.warning(res.message);\r\n            }\r\n          }).finally(() => {\r\n          })\r\n        }\r\n      },\r\n      // 获取数据库的类型\r\n      getsqlType() {\r\n        var obj = {}\r\n        getAction(this.url.sqlType, obj).then((res) => {\r\n          console.log(res)\r\n          if (res.success) {\r\n            this.sqlType = res.result\r\n          } else {\r\n            this.$message.warning(res.message);\r\n          }\r\n        }).finally(() => {\r\n        })\r\n      },\r\n      getValue(code) {\r\n        setTimeout(() => {\r\n          this.form.setFieldsValue({\r\n            'cgrSql': code\r\n          })\r\n        }, 0)\r\n      },\r\n      compareToFirstPassword(rule, value, callback) {\r\n        var httpurl = this.url.yanzheng\r\n        var obj = {\r\n          tableName: 'onl_cgreport_head',\r\n          fieldName: 'code',\r\n          fieldVal: value,\r\n        }\r\n        if(value == '') {\r\n          callback('请输入编码!');\r\n        }else{\r\n          getAction(httpurl, obj).then((res) => {\r\n            var data = res\r\n            console.log(data)\r\n            if(data.success) {\r\n              callback();\r\n            }else {\r\n              callback('数据库已有此字段，请不要重复添加!');\r\n            }\r\n          }).finally(() => {\r\n          })\r\n        }\r\n      },\r\n      // 保存数据\r\n      saveEdit(row) {\r\n        var id = row.orderNum-1\r\n        this.fields[id] = row\r\n      },\r\n      saveEditparams(row) {\r\n        var id = row.orderNum-1\r\n        this.params[id] = row\r\n      },\r\n      // 删除选中的rows\r\n      remove() {\r\n        var arr = this.selectedRowIds\r\n        arr.sort(function(a,b){\r\n          return  b - a;\r\n        })\r\n        for(var i = 0 ;  i < arr.length ; i++) {\r\n          this.fields.splice(arr[i]-1,1)\r\n        }\r\n        this.selectedRowIds = []\r\n      },\r\n      removeparams() {\r\n        var arr = this.selectedRowIds\r\n        arr.sort(function(a,b){\r\n          return  b - a;\r\n        })\r\n        for(var i = 0 ;  i < arr.length ; i++) {\r\n          this.params.splice(arr[i]-1,1)\r\n        }\r\n        this.selectedRowIds = []\r\n      },\r\n      // 获取选中的row\r\n      selectRows(rows) {\r\n        var arr =  []\r\n        for(var i = 0 ; i < rows.length ;  i++) {\r\n          arr.push(rows[i].orderNum)\r\n        }\r\n        this.selectedRowIds = arr\r\n      },\r\n      paramsadd() {\r\n        this.params.push({\r\n          orderNum: '',\r\n          paramName: \"\",\r\n          paramTxt: \"\",\r\n          paramValue: \"\",\r\n        })\r\n      },\r\n      selfadd() {\r\n        this.fields.push({\r\n          dictCode: \"\",\r\n          fieldHref: \"\",\r\n          fieldName: \"\",\r\n          fieldTxt: \"\",\r\n          fieldType: \"String\",\r\n          groupTitle: \"\",\r\n          isSearch: \"0\",\r\n          isShow: 1,\r\n          isTotal: \"0\",\r\n          orderNum: '',\r\n          replaceVal: \"\",\r\n          searchMode: \"\",\r\n        })\r\n      },\r\n      callback(key) {\r\n        console.log(key);\r\n      },\r\n      add() {\r\n        this.id = ''\r\n        this.edit({\r\n          cgrSql: \"\",\r\n          code: \"\",\r\n          name: \"\",\r\n          dbSource:''\r\n        });\r\n        this.sqlValue = ''\r\n        this.fields = []\r\n      },\r\n      edit(record) {\r\n        console.log(record)\r\n        this.id = record.id\r\n        if(record.id) {\r\n          // 获取下面的表单\r\n          getAction(this.url.head, {headId: record.id}).then((res) => {\r\n            console.log(res)\r\n            if (res.success) {\r\n              this.fields = res.result\r\n            } else {\r\n              this.$message.warning(res.message);\r\n            }\r\n          }).finally(() => {\r\n          })\r\n          getAction(this.url.param, {headId: record.id}).then((res) => {\r\n            console.log(res)\r\n            if (res.success) {\r\n              this.params = res.result\r\n            } else {\r\n              this.$message.warning(res.message);\r\n            }\r\n          }).finally(() => {\r\n          })\r\n        }\r\n\r\n        this.taskId =\"\"\r\n        this.form.resetFields();\r\n        this.model = Object.assign({}, record);\r\n        this.visible = true;\r\n        this.sqlValue = record.cgrSql\r\n        this.$nextTick(() => {\r\n          this.form.setFieldsValue(pick(this.model,'code','name','dbSource','cgrSql'))\r\n        })\r\n      },\r\n      close() {\r\n        this.$emit('close');\r\n        this.visible = false;\r\n      },\r\n      handleOk() {\r\n        const that = this;\r\n        // 触发表单验证\r\n        this.form.validateFields((err, values) => {\r\n          if (!err) {\r\n            that.confirmLoading = true;\r\n            var obj = {\r\n              tableName: 'onl_cgreport_head',\r\n              fieldName: 'code',\r\n              fieldVal: that.form.getFieldValue('code'),\r\n            }\r\n            getAction(this.url.yanzheng, obj).then((res) => {\r\n              console.log(res)\r\n              if (res.success) {\r\n                let httpurl = '';\r\n                let method = '';\r\n                if (!this.model.id) {\r\n                  httpurl += this.url.add;\r\n                  method = 'post';\r\n                } else {\r\n                  httpurl += this.url.edit;\r\n                  method = 'put';\r\n                }\r\n                if(this.fields.length!=0&&this.params.length!=0) {\r\n\r\n                }\r\n                let formData = Object.assign(this.model, values);\r\n                console.log(\"表单提交数据\", formData)\r\n                var obj = {\r\n                  deleteItemIds:\"\",\r\n                  deleteParamIds:\"\",\r\n                  head:Object.assign(this.model, values),\r\n                  items: this.fields,\r\n                  params:this.params\r\n                }\r\n                httpAction(httpurl, obj, method).then((res) => {\r\n                  if (res.success) {\r\n                    that.$message.success(res.message);\r\n                    that.$emit('ok');\r\n                  } else {\r\n                    that.$message.warning(res.message);\r\n                  }\r\n                }).finally(() => {\r\n                  that.confirmLoading = false;\r\n                  that.close();\r\n                })\r\n              } else {\r\n                this.$message.warning(res.message);\r\n              }\r\n            }).finally(() => {\r\n              that.confirmLoading = false;\r\n              that.close();\r\n            })\r\n\r\n          }\r\n\r\n        })\r\n      },\r\n      handleCancel() {\r\n        this.close()\r\n      },\r\n      popupCallback(row) {\r\n        this.form.setFieldsValue(pick(row, 'name'))\r\n      },\r\n\r\n    }\r\n  }\r\n  </script>\r\n  <style scoped>\r\n  .form-item {\r\n    margin-left: 15px\r\n  }\r\n\r\n  /deep/ .ant-form .ant-form-item {\r\n    margin-bottom: 0;\r\n  }\r\n\r\n  /deep/ .form-item {\r\n    margin-left: 0;\r\n  }\r\n\r\n  /deep/ .ant-form > .ant-row {\r\n    border-bottom: 1px solid #e8e8e8;\r\n    padding: 12px 0;\r\n  }\r\n\r\n  /deep/ .ant-form label {\r\n    font-size: 12px;\r\n  }\r\n  /deep/.tootle .ant-tooltip-inner {\r\n    background: #fff;\r\n  }\r\n  </style>"]}]}