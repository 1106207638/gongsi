{"remainingRequest":"D:\\vue\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\vue\\src\\components\\jeecgbiz\\modal\\JSelectDepartModal.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\vue\\src\\components\\jeecgbiz\\modal\\JSelectDepartModal.vue","mtime":1615948816020},{"path":"D:\\vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1615952641464},{"path":"D:\\vue\\node_modules\\babel-loader\\lib\\index.js","mtime":1615952610415},{"path":"D:\\vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1615952641464},{"path":"D:\\vue\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader\\lib\\index.js","mtime":1615952643260}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IHF1ZXJ5RGVwYXJ0VHJlZUxpc3QgfSBmcm9tICdAL2FwaS9hcGknCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnSlNlbGVjdERlcGFydE1vZGFsJywKICBwcm9wczpbJ21vZGFsV2lkdGgnLCdtdWx0aScsJ3Jvb3RPcGVuZWQnLCdkZXBhcnRJZCddLAogIGRhdGEoKXsKICAgIHJldHVybiB7CiAgICAgIHZpc2libGU6ZmFsc2UsCiAgICAgIGNvbmZpcm1Mb2FkaW5nOmZhbHNlLAogICAgICB0cmVlRGF0YTpbXSwKICAgICAgYXV0b0V4cGFuZFBhcmVudDp0cnVlLAogICAgICBleHBhbmRlZEtleXM6W10sCiAgICAgIGRhdGFMaXN0OltdLAogICAgICBjaGVja2VkS2V5czpbXSwKICAgICAgY2hlY2tlZFJvd3M6W10sCiAgICAgIHNlYXJjaFZhbHVlOiIiCiAgICB9CiAgfSwKICBjcmVhdGVkKCl7CiAgICB0aGlzLmxvYWREZXBhcnQoKTsKICB9LAogIHdhdGNoOnsKICAgIGRlcGFydElkKCl7CiAgICAgIHRoaXMuaW5pdERlcGFydENvbXBvbmVudCgpCiAgICB9LAogICAgdmlzaWJsZTogewogICAgICBoYW5kbGVyKCkgewogICAgICAgIGlmICh0aGlzLmRlcGFydElkKSB7CiAgICAgICAgICB0aGlzLmNoZWNrZWRLZXlzID0gdGhpcy5kZXBhcnRJZC5zcGxpdCgiLCIpOwogICAgICAgICAgLy8gY29uc29sZS5sb2coJ3RoaXMuZGVwYXJ0SWQnLCB0aGlzLmRlcGFydElkKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmNoZWNrZWRLZXlzID0gW107CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSwKICBtZXRob2RzOnsKICAgIHNob3coKXsKICAgICAgdGhpcy52aXNpYmxlPXRydWUKICAgICAgdGhpcy5jaGVja2VkUm93cz1bXQogICAgICB0aGlzLmNoZWNrZWRLZXlzPVtdCiAgICB9LAogICAgbG9hZERlcGFydCgpewogICAgICBxdWVyeURlcGFydFRyZWVMaXN0KCkudGhlbihyZXM9PnsKICAgICAgICBpZihyZXMuc3VjY2Vzcyl7CiAgICAgICAgICBsZXQgYXJyID0gWy4uLnJlcy5yZXN1bHRdCiAgICAgICAgICB0aGlzLnJlV3JpdGVyV2l0aFNsb3QoYXJyKQogICAgICAgICAgdGhpcy50cmVlRGF0YSA9IGFycgogICAgICAgICAgdGhpcy5pbml0RGVwYXJ0Q29tcG9uZW50KCkKICAgICAgICAgIGlmKHRoaXMucm9vdE9wZW5lZCl7CiAgICAgICAgICAgIHRoaXMuaW5pdEV4cGFuZGVkS2V5cyhyZXMucmVzdWx0KQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSkKICAgIH0sCiAgICBpbml0RGVwYXJ0Q29tcG9uZW50KCl7CiAgICAgIGxldCBuYW1lcyA9ICcnCiAgICAgIGlmKHRoaXMuZGVwYXJ0SWQpewogICAgICAgIGxldCBjdXJyRGVwYXJ0SWQgPSB0aGlzLmRlcGFydElkCiAgICAgICAgZm9yKGxldCBpdGVtIG9mIHRoaXMuZGF0YUxpc3QpewogICAgICAgICAgaWYoY3VyckRlcGFydElkLmluZGV4T2YoaXRlbS5rZXkpPj0wKXsKICAgICAgICAgICAgbmFtZXMrPSIsIitpdGVtLnRpdGxlCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmKG5hbWVzKXsKICAgICAgICAgIG5hbWVzID0gbmFtZXMuc3Vic3RyaW5nKDEpCiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuJGVtaXQoImluaXRDb21wIixuYW1lcykKICAgIH0sCiAgICByZVdyaXRlcldpdGhTbG90KGFycil7CiAgICAgIGZvcihsZXQgaXRlbSBvZiBhcnIpewogICAgICAgIGlmKGl0ZW0uY2hpbGRyZW4gJiYgaXRlbS5jaGlsZHJlbi5sZW5ndGg+MCl7CiAgICAgICAgICB0aGlzLnJlV3JpdGVyV2l0aFNsb3QoaXRlbS5jaGlsZHJlbikKICAgICAgICAgIGxldCB0ZW1wID0gT2JqZWN0LmFzc2lnbih7fSxpdGVtKQogICAgICAgICAgdGVtcC5jaGlsZHJlbiA9IHt9CiAgICAgICAgICB0aGlzLmRhdGFMaXN0LnB1c2godGVtcCkKICAgICAgICB9ZWxzZXsKICAgICAgICAgIHRoaXMuZGF0YUxpc3QucHVzaChpdGVtKQogICAgICAgICAgaXRlbS5zY29wZWRTbG90cz17IHRpdGxlOiAndGl0bGUnIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBpbml0RXhwYW5kZWRLZXlzKGFycil7CiAgICAgIGlmKGFyciAmJiBhcnIubGVuZ3RoPjApewogICAgICAgIGxldCBrZXlzID0gW10KICAgICAgICBmb3IobGV0IGl0ZW0gb2YgYXJyKXsKICAgICAgICAgIGlmKGl0ZW0uY2hpbGRyZW4gJiYgaXRlbS5jaGlsZHJlbi5sZW5ndGg+MCl7CiAgICAgICAgICAgIGtleXMucHVzaChpdGVtLmlkKQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aGlzLmV4cGFuZGVkS2V5cz1bLi4ua2V5c10KICAgICAgfWVsc2V7CiAgICAgICAgdGhpcy5leHBhbmRlZEtleXM9W10KICAgICAgfQogICAgfSwKICAgIG9uQ2hlY2sgKGNoZWNrZWRLZXlzLGluZm8pIHsKICAgICAgaWYoIXRoaXMubXVsdGkpewogICAgICAgIGxldCBhcnIgPSBjaGVja2VkS2V5cy5jaGVja2VkLmZpbHRlcihpdGVtID0+IHRoaXMuY2hlY2tlZEtleXMuaW5kZXhPZihpdGVtKSA8IDApCiAgICAgICAgdGhpcy5jaGVja2VkS2V5cyA9IFsuLi5hcnJdCiAgICAgICAgdGhpcy5jaGVja2VkUm93cyA9ICh0aGlzLmNoZWNrZWRLZXlzLmxlbmd0aCA9PT0gMCkgPyBbXSA6IFtpbmZvLm5vZGUuZGF0YVJlZl0KICAgICAgfWVsc2V7CiAgICAgICAgdGhpcy5jaGVja2VkS2V5cyA9IGNoZWNrZWRLZXlzLmNoZWNrZWQKICAgICAgICB0aGlzLmNoZWNrZWRSb3dzID0gdGhpcy5nZXRDaGVja2VkUm93cyh0aGlzLmNoZWNrZWRLZXlzKQogICAgICB9CiAgICB9LAogICAgb25TZWxlY3Qoc2VsZWN0ZWRLZXlzLGluZm8pIHsKICAgICAgbGV0IGtleXMgPSBbXQogICAgICBrZXlzLnB1c2goc2VsZWN0ZWRLZXlzWzBdKQogICAgICBpZighdGhpcy5jaGVja2VkS2V5cyB8fCB0aGlzLmNoZWNrZWRLZXlzLmxlbmd0aD09PTAgfHwgIXRoaXMubXVsdGkpewogICAgICAgIHRoaXMuY2hlY2tlZEtleXMgPSBbLi4ua2V5c10KICAgICAgICB0aGlzLmNoZWNrZWRSb3dzPVtpbmZvLm5vZGUuZGF0YVJlZl0KICAgICAgfWVsc2V7CiAgICAgICAgbGV0IGN1cnJLZXkgPSBpbmZvLm5vZGUuZGF0YVJlZi5rZXkKICAgICAgICBpZih0aGlzLmNoZWNrZWRLZXlzLmluZGV4T2YoY3VycktleSk+PTApewogICAgICAgICAgdGhpcy5jaGVja2VkS2V5cyA9IHRoaXMuY2hlY2tlZEtleXMuZmlsdGVyKGl0ZW09PiBpdGVtICE9PWN1cnJLZXkpCiAgICAgICAgfWVsc2V7CiAgICAgICAgICB0aGlzLmNoZWNrZWRLZXlzLnB1c2goLi4ua2V5cykKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5jaGVja2VkUm93cyA9IHRoaXMuZ2V0Q2hlY2tlZFJvd3ModGhpcy5jaGVja2VkS2V5cykKICAgIH0sCiAgICBvbkV4cGFuZCAoZXhwYW5kZWRLZXlzKSB7CiAgICAgIHRoaXMuZXhwYW5kZWRLZXlzID0gZXhwYW5kZWRLZXlzCiAgICAgIHRoaXMuYXV0b0V4cGFuZFBhcmVudCA9IGZhbHNlCiAgICB9LAogICAgaGFuZGxlU3VibWl0KCl7CiAgICAgIGlmKCF0aGlzLmNoZWNrZWRLZXlzIHx8IHRoaXMuY2hlY2tlZEtleXMubGVuZ3RoPT0wKXsKICAgICAgICB0aGlzLiRlbWl0KCJvayIsJycpCiAgICAgIH1lbHNlewogICAgICAgIHRoaXMuJGVtaXQoIm9rIix0aGlzLmNoZWNrZWRSb3dzLHRoaXMuY2hlY2tlZEtleXMuam9pbigiLCIpKQogICAgICB9CiAgICAgIHRoaXMuaGFuZGxlQ2xlYXIoKQogICAgfSwKICAgIGhhbmRsZUNhbmNlbCgpewogICAgICB0aGlzLmhhbmRsZUNsZWFyKCkKICAgIH0sCiAgICBoYW5kbGVDbGVhcigpewogICAgICB0aGlzLnZpc2libGU9ZmFsc2UKICAgICAgdGhpcy5jaGVja2VkS2V5cz1bXQogICAgfSwKICAgIGdldFBhcmVudEtleShjdXJyS2V5LHRyZWVEYXRhKXsKICAgICAgbGV0IHBhcmVudEtleQogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRyZWVEYXRhLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IHRyZWVEYXRhW2ldCiAgICAgICAgaWYgKG5vZGUuY2hpbGRyZW4pIHsKICAgICAgICAgIGlmIChub2RlLmNoaWxkcmVuLnNvbWUoaXRlbSA9PiBpdGVtLmtleSA9PT0gY3VycktleSkpIHsKICAgICAgICAgICAgcGFyZW50S2V5ID0gbm9kZS5rZXkKICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5nZXRQYXJlbnRLZXkoY3VycktleSwgbm9kZS5jaGlsZHJlbikpIHsKICAgICAgICAgICAgcGFyZW50S2V5ID0gdGhpcy5nZXRQYXJlbnRLZXkoY3VycktleSwgbm9kZS5jaGlsZHJlbikKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHBhcmVudEtleQogICAgfSwKICAgIG9uU2VhcmNoKHZhbHVlKXsKICAgICAgY29uc3QgZXhwYW5kZWRLZXlzID0gdGhpcy5kYXRhTGlzdC5tYXAoKGl0ZW0pID0+IHsKICAgICAgICBpZiAoaXRlbS50aXRsZS5pbmRleE9mKHZhbHVlKSA+IC0xKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5nZXRQYXJlbnRLZXkoaXRlbS5rZXksdGhpcy50cmVlRGF0YSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGwKICAgICAgfSkuZmlsdGVyKChpdGVtLCBpLCBzZWxmKSA9PiBpdGVtICYmIHNlbGYuaW5kZXhPZihpdGVtKSA9PT0gaSkKCiAgICAgIE9iamVjdC5hc3NpZ24odGhpcywgewogICAgICAgIGV4cGFuZGVkS2V5cywKICAgICAgICBzZWFyY2hWYWx1ZTogdmFsdWUsCiAgICAgICAgYXV0b0V4cGFuZFBhcmVudDogdHJ1ZSwKICAgICAgfSkKCgogICAgfSwKICAgIC8vIOagueaNriBjaGVja2VkS2V5cyDojrflj5Ygcm93cwogICAgZ2V0Q2hlY2tlZFJvd3MoY2hlY2tlZEtleXMpIHsKICAgICAgY29uc3QgZm9yQ2hpbGRyZW4gPSAobGlzdCwga2V5KSA9PiB7CiAgICAgICAgZm9yIChsZXQgaXRlbSBvZiBsaXN0KSB7CiAgICAgICAgICBpZiAoaXRlbS5pZCA9PT0ga2V5KSB7CiAgICAgICAgICAgIHJldHVybiBpdGVtCiAgICAgICAgICB9CiAgICAgICAgICBpZiAoaXRlbS5jaGlsZHJlbiBpbnN0YW5jZW9mIEFycmF5KSB7CiAgICAgICAgICAgIGxldCB2YWx1ZSA9IGZvckNoaWxkcmVuKGl0ZW0uY2hpbGRyZW4sIGtleSkKICAgICAgICAgICAgaWYgKHZhbHVlICE9IG51bGwpIHsKICAgICAgICAgICAgICByZXR1cm4gdmFsdWUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbAogICAgICB9CgogICAgICBsZXQgcm93cyA9IFtdCiAgICAgIGZvciAobGV0IGtleSBvZiBjaGVja2VkS2V5cykgewogICAgICAgIGxldCByb3cgPSBmb3JDaGlsZHJlbih0aGlzLnRyZWVEYXRhLCBrZXkpCiAgICAgICAgaWYgKHJvdyAhPSBudWxsKSB7CiAgICAgICAgICByb3dzLnB1c2gocm93KQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcm93cwogICAgfQogIH0KfQoK"},{"version":3,"sources":["JSelectDepartModal.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"JSelectDepartModal.vue","sourceRoot":"src/components/jeecgbiz/modal","sourcesContent":["<template>\r\n  <j-modal\r\n    title=\"选择部门\"\r\n    :width=\"modalWidth\"\r\n    :visible=\"visible\"\r\n    :confirmLoading=\"confirmLoading\"\r\n    @ok=\"handleSubmit\"\r\n    @cancel=\"handleCancel\"\r\n    switchFullscreen\r\n    cancelText=\"关闭\">\r\n    <a-spin tip=\"Loading...\" :spinning=\"false\">\r\n      <a-input-search style=\"margin-bottom: 1px\" placeholder=\"请输入部门名称按回车进行搜索\" @search=\"onSearch\" />\r\n      <a-tree\r\n        checkable\r\n        class=\"my-dept-select-tree\"\r\n        :treeData=\"treeData\"\r\n        :checkStrictly=\"true\"\r\n        @check=\"onCheck\"\r\n        @select=\"onSelect\"\r\n        @expand=\"onExpand\"\r\n        :autoExpandParent=\"autoExpandParent\"\r\n        :expandedKeys=\"expandedKeys\"\r\n        :checkedKeys=\"checkedKeys\">\r\n\r\n        <template slot=\"title\" slot-scope=\"{title}\">\r\n          <span v-if=\"title.indexOf(searchValue) > -1\">\r\n            {{title.substr(0, title.indexOf(searchValue))}}\r\n            <span style=\"color: #f50\">{{searchValue}}</span>\r\n            {{title.substr(title.indexOf(searchValue) + searchValue.length)}}\r\n          </span>\r\n          <span v-else>{{title}}</span>\r\n        </template>\r\n      </a-tree>\r\n\r\n    </a-spin>\r\n  </j-modal>\r\n</template>\r\n\r\n<script>\r\n  import { queryDepartTreeList } from '@/api/api'\r\n  export default {\r\n    name: 'JSelectDepartModal',\r\n    props:['modalWidth','multi','rootOpened','departId'],\r\n    data(){\r\n      return {\r\n        visible:false,\r\n        confirmLoading:false,\r\n        treeData:[],\r\n        autoExpandParent:true,\r\n        expandedKeys:[],\r\n        dataList:[],\r\n        checkedKeys:[],\r\n        checkedRows:[],\r\n        searchValue:\"\"\r\n      }\r\n    },\r\n    created(){\r\n      this.loadDepart();\r\n    },\r\n    watch:{\r\n      departId(){\r\n        this.initDepartComponent()\r\n      },\r\n      visible: {\r\n        handler() {\r\n          if (this.departId) {\r\n            this.checkedKeys = this.departId.split(\",\");\r\n            // console.log('this.departId', this.departId)\r\n          } else {\r\n            this.checkedKeys = [];\r\n          }\r\n        }\r\n      }\r\n    },\r\n    methods:{\r\n      show(){\r\n        this.visible=true\r\n        this.checkedRows=[]\r\n        this.checkedKeys=[]\r\n      },\r\n      loadDepart(){\r\n        queryDepartTreeList().then(res=>{\r\n          if(res.success){\r\n            let arr = [...res.result]\r\n            this.reWriterWithSlot(arr)\r\n            this.treeData = arr\r\n            this.initDepartComponent()\r\n            if(this.rootOpened){\r\n              this.initExpandedKeys(res.result)\r\n            }\r\n          }\r\n        })\r\n      },\r\n      initDepartComponent(){\r\n        let names = ''\r\n        if(this.departId){\r\n          let currDepartId = this.departId\r\n          for(let item of this.dataList){\r\n            if(currDepartId.indexOf(item.key)>=0){\r\n              names+=\",\"+item.title\r\n            }\r\n          }\r\n          if(names){\r\n            names = names.substring(1)\r\n          }\r\n        }\r\n        this.$emit(\"initComp\",names)\r\n      },\r\n      reWriterWithSlot(arr){\r\n        for(let item of arr){\r\n          if(item.children && item.children.length>0){\r\n            this.reWriterWithSlot(item.children)\r\n            let temp = Object.assign({},item)\r\n            temp.children = {}\r\n            this.dataList.push(temp)\r\n          }else{\r\n            this.dataList.push(item)\r\n            item.scopedSlots={ title: 'title' }\r\n          }\r\n        }\r\n      },\r\n      initExpandedKeys(arr){\r\n        if(arr && arr.length>0){\r\n          let keys = []\r\n          for(let item of arr){\r\n            if(item.children && item.children.length>0){\r\n              keys.push(item.id)\r\n            }\r\n          }\r\n          this.expandedKeys=[...keys]\r\n        }else{\r\n          this.expandedKeys=[]\r\n        }\r\n      },\r\n      onCheck (checkedKeys,info) {\r\n        if(!this.multi){\r\n          let arr = checkedKeys.checked.filter(item => this.checkedKeys.indexOf(item) < 0)\r\n          this.checkedKeys = [...arr]\r\n          this.checkedRows = (this.checkedKeys.length === 0) ? [] : [info.node.dataRef]\r\n        }else{\r\n          this.checkedKeys = checkedKeys.checked\r\n          this.checkedRows = this.getCheckedRows(this.checkedKeys)\r\n        }\r\n      },\r\n      onSelect(selectedKeys,info) {\r\n        let keys = []\r\n        keys.push(selectedKeys[0])\r\n        if(!this.checkedKeys || this.checkedKeys.length===0 || !this.multi){\r\n          this.checkedKeys = [...keys]\r\n          this.checkedRows=[info.node.dataRef]\r\n        }else{\r\n          let currKey = info.node.dataRef.key\r\n          if(this.checkedKeys.indexOf(currKey)>=0){\r\n            this.checkedKeys = this.checkedKeys.filter(item=> item !==currKey)\r\n          }else{\r\n            this.checkedKeys.push(...keys)\r\n          }\r\n        }\r\n        this.checkedRows = this.getCheckedRows(this.checkedKeys)\r\n      },\r\n      onExpand (expandedKeys) {\r\n        this.expandedKeys = expandedKeys\r\n        this.autoExpandParent = false\r\n      },\r\n      handleSubmit(){\r\n        if(!this.checkedKeys || this.checkedKeys.length==0){\r\n          this.$emit(\"ok\",'')\r\n        }else{\r\n          this.$emit(\"ok\",this.checkedRows,this.checkedKeys.join(\",\"))\r\n        }\r\n        this.handleClear()\r\n      },\r\n      handleCancel(){\r\n        this.handleClear()\r\n      },\r\n      handleClear(){\r\n        this.visible=false\r\n        this.checkedKeys=[]\r\n      },\r\n      getParentKey(currKey,treeData){\r\n        let parentKey\r\n        for (let i = 0; i < treeData.length; i++) {\r\n          const node = treeData[i]\r\n          if (node.children) {\r\n            if (node.children.some(item => item.key === currKey)) {\r\n              parentKey = node.key\r\n            } else if (this.getParentKey(currKey, node.children)) {\r\n              parentKey = this.getParentKey(currKey, node.children)\r\n            }\r\n          }\r\n        }\r\n        return parentKey\r\n      },\r\n      onSearch(value){\r\n        const expandedKeys = this.dataList.map((item) => {\r\n          if (item.title.indexOf(value) > -1) {\r\n            return this.getParentKey(item.key,this.treeData)\r\n          }\r\n          return null\r\n        }).filter((item, i, self) => item && self.indexOf(item) === i)\r\n\r\n        Object.assign(this, {\r\n          expandedKeys,\r\n          searchValue: value,\r\n          autoExpandParent: true,\r\n        })\r\n\r\n\r\n      },\r\n      // 根据 checkedKeys 获取 rows\r\n      getCheckedRows(checkedKeys) {\r\n        const forChildren = (list, key) => {\r\n          for (let item of list) {\r\n            if (item.id === key) {\r\n              return item\r\n            }\r\n            if (item.children instanceof Array) {\r\n              let value = forChildren(item.children, key)\r\n              if (value != null) {\r\n                return value\r\n              }\r\n            }\r\n          }\r\n          return null\r\n        }\r\n\r\n        let rows = []\r\n        for (let key of checkedKeys) {\r\n          let row = forChildren(this.treeData, key)\r\n          if (row != null) {\r\n            rows.push(row)\r\n          }\r\n        }\r\n        return rows\r\n      }\r\n    }\r\n  }\r\n\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n  // 限制部门选择树高度，避免部门太多时点击确定不便\r\n  .my-dept-select-tree{\r\n    height: 350px;\r\n    overflow-y: scroll;\r\n  }\r\n\r\n</style>"]}]}