{"remainingRequest":"D:\\vue\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\vue\\src\\views\\system\\modules\\DeptRoleDataruleModal.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\vue\\src\\views\\system\\modules\\DeptRoleDataruleModal.vue","mtime":1615948821486},{"path":"D:\\vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1615952641464},{"path":"D:\\vue\\node_modules\\babel-loader\\lib\\index.js","mtime":1615952610415},{"path":"D:\\vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1615952641464},{"path":"D:\\vue\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader\\lib\\index.js","mtime":1615952643260}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBBUm93IGZyb20gJ2FudC1kZXNpZ24tdnVlL2VzL2dyaWQvUm93JwppbXBvcnQgQUNvbCBmcm9tICdhbnQtZGVzaWduLXZ1ZS9lcy9ncmlkL0NvbCcKaW1wb3J0IHsgZ2V0QWN0aW9uLHBvc3RBY3Rpb24gfSBmcm9tICdAL2FwaS9tYW5hZ2UnCgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ0RlcHRSb2xlRGF0YXJ1bGVNb2RhbCcsCiAgY29tcG9uZW50czogeyBBQ29sLCBBUm93IH0sCiAgZGF0YSgpewogICAgcmV0dXJuIHsKICAgICAgZGVwYXJ0SWQ6JycsCiAgICAgIGZ1bmN0aW9uSWQ6JycsCiAgICAgIHJvbGVJZDonJywKICAgICAgdmlzaWJsZTpmYWxzZSwKICAgICAgdGFiTGlzdDogW3sKICAgICAgICBrZXk6ICcxJywKICAgICAgICB0YWI6ICfmlbDmja7op4TliJknLAogICAgICB9LCB7CiAgICAgICAga2V5OiAnMicsCiAgICAgICAgdGFiOiAn5oyJ6ZKu5p2D6ZmQJywKICAgICAgfV0sCiAgICAgIGFjdGl2ZVRhYktleTogJzEnLAogICAgICB1cmw6ewogICAgICAgIGRhdGFydWxlOiIvc3lzL3N5c0RlcGFydFJvbGUvZGF0YXJ1bGUiLAogICAgICB9LAogICAgICBkYXRhcnVsZUxpc3Q6W10sCiAgICAgIGRhdGFydWxlQ2hlY2tlZDpbXQogICAgfQogIH0sCiAgbWV0aG9kczp7CiAgICBsb2FkRGF0YSgpewogICAgICBnZXRBY3Rpb24oYCR7dGhpcy51cmwuZGF0YXJ1bGV9LyR7dGhpcy5mdW5jdGlvbklkfS8ke3RoaXMuZGVwYXJ0SWR9LyR7dGhpcy5yb2xlSWR9YCkudGhlbihyZXM9PnsKICAgICAgICBjb25zb2xlLmxvZyhyZXMpCiAgICAgICAgaWYocmVzLnN1Y2Nlc3MpewogICAgICAgICAgdGhpcy5kYXRhcnVsZUxpc3QgPSByZXMucmVzdWx0LmRhdGFydWxlCiAgICAgICAgICBsZXQgZHJDaGVja2VkID0gcmVzLnJlc3VsdC5kckNoZWNrZWQKICAgICAgICAgIGlmKGRyQ2hlY2tlZCl7CiAgICAgICAgICAgIHRoaXMuZGF0YXJ1bGVDaGVja2VkID0gZHJDaGVja2VkLnNwbGl0KCIsIikKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pCiAgICB9LAogICAgc2F2ZURhdGFydWxlRm9yUm9sZSgpewogICAgICBpZighdGhpcy5kYXRhcnVsZUNoZWNrZWQgfHwgdGhpcy5kYXRhcnVsZUNoZWNrZWQubGVuZ3RoPT0wKXsKICAgICAgICB0aGlzLiRtZXNzYWdlLndhcm5pbmcoIuivt+azqOaEj++8jOeOsOacquWLvumAieS7u+S9leaVsOaNruadg+mZkCEiKQogICAgICB9CiAgICAgIGxldCBwYXJhbXMgPSB7CiAgICAgICAgcGVybWlzc2lvbklkOnRoaXMuZnVuY3Rpb25JZCwKICAgICAgICByb2xlSWQ6dGhpcy5yb2xlSWQsCiAgICAgICAgZGF0YVJ1bGVJZHM6dGhpcy5kYXRhcnVsZUNoZWNrZWQuam9pbigiLCIpCiAgICAgIH0KICAgICAgY29uc29sZS5sb2coIuS/neWtmOaVsOaNruadg+mZkCIscGFyYW1zKQogICAgICBwb3N0QWN0aW9uKHRoaXMudXJsLmRhdGFydWxlLHBhcmFtcykudGhlbihyZXM9PnsKICAgICAgICBpZihyZXMuc3VjY2Vzcyl7CiAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MocmVzLm1lc3NhZ2UpCiAgICAgICAgfWVsc2V7CiAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKHJlcy5tZXNzYWdlKQogICAgICAgIH0KICAgICAgfSkKICAgIH0sCiAgICBzaG93KGZ1bmN0aW9uSWQsZGVwYXJ0SWQscm9sZUlkKXsKICAgICAgdGhpcy5vblJlc2V0KCkKICAgICAgdGhpcy5kZXBhcnRJZCA9IGRlcGFydElkCiAgICAgIHRoaXMuZnVuY3Rpb25JZCA9IGZ1bmN0aW9uSWQKICAgICAgdGhpcy5yb2xlSWQgPSByb2xlSWQKICAgICAgdGhpcy52aXNpYmxlPXRydWUKICAgICAgdGhpcy5sb2FkRGF0YSgpCiAgICB9LAogICAgb25DbG9zZSgpewogICAgICB0aGlzLnZpc2libGU9ZmFsc2UKICAgICAgdGhpcy5vblJlc2V0KCkKICAgIH0sCiAgICBvblRhYkNoYW5nZSAoa2V5KSB7CiAgICAgIHRoaXMuYWN0aXZlVGFiS2V5ID0ga2V5CiAgICB9LAogICAgb25SZXNldCgpewogICAgICB0aGlzLmZ1bmN0aW9uSWQ9JycKICAgICAgdGhpcy5yb2xlSWQ9JycKICAgICAgdGhpcy5kYXRhcnVsZUxpc3Q9W10KICAgICAgdGhpcy5kYXRhcnVsZUNoZWNrZWQ9W10KICAgIH0KICB9Cn0K"},{"version":3,"sources":["DeptRoleDataruleModal.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmCA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"DeptRoleDataruleModal.vue","sourceRoot":"src/views/system/modules","sourcesContent":["<template>\r\n  <a-drawer\r\n    title=\"数据规则/按钮权限配置\"\r\n    width=\"365\"\r\n    :closable=\"false\"\r\n    @close=\"onClose\"\r\n    :visible=\"visible\"\r\n  >\r\n\r\n    <a-tabs defaultActiveKey=\"1\">\r\n      <a-tab-pane tab=\"数据规则\" key=\"1\">\r\n\r\n        <a-checkbox-group v-model=\"dataruleChecked\" v-if=\"dataruleList.length>0\">\r\n          <a-row>\r\n            <a-col :span=\"24\" v-for=\"(item,index) in dataruleList\" :key=\" 'dr'+index \">\r\n              <a-checkbox :value=\"item.id\">{{ item.ruleName }}</a-checkbox>\r\n            </a-col>\r\n\r\n            <a-col :span=\"24\">\r\n              <div style=\"width: 100%;margin-top: 15px\">\r\n                <a-button @click=\"saveDataruleForRole\" type=\"primary\" size=\"small\" icon=\"save\">点击保存</a-button>\r\n              </div>\r\n            </a-col>\r\n          </a-row>\r\n        </a-checkbox-group>\r\n        <div v-else><h3>无配置信息!</h3></div>\r\n\r\n      </a-tab-pane>\r\n      <!--<a-tab-pane tab=\"按钮权限\" key=\"2\">敬请期待!!!</a-tab-pane>-->\r\n    </a-tabs>\r\n\r\n  </a-drawer>\r\n</template>\r\n\r\n<script>\r\n  import ARow from 'ant-design-vue/es/grid/Row'\r\n  import ACol from 'ant-design-vue/es/grid/Col'\r\n  import { getAction,postAction } from '@/api/manage'\r\n\r\n  export default {\r\n    name: 'DeptRoleDataruleModal',\r\n    components: { ACol, ARow },\r\n    data(){\r\n      return {\r\n        departId:'',\r\n        functionId:'',\r\n        roleId:'',\r\n        visible:false,\r\n        tabList: [{\r\n          key: '1',\r\n          tab: '数据规则',\r\n        }, {\r\n          key: '2',\r\n          tab: '按钮权限',\r\n        }],\r\n        activeTabKey: '1',\r\n        url:{\r\n          datarule:\"/sys/sysDepartRole/datarule\",\r\n        },\r\n        dataruleList:[],\r\n        dataruleChecked:[]\r\n      }\r\n    },\r\n    methods:{\r\n      loadData(){\r\n        getAction(`${this.url.datarule}/${this.functionId}/${this.departId}/${this.roleId}`).then(res=>{\r\n          console.log(res)\r\n          if(res.success){\r\n            this.dataruleList = res.result.datarule\r\n            let drChecked = res.result.drChecked\r\n            if(drChecked){\r\n              this.dataruleChecked = drChecked.split(\",\")\r\n            }\r\n          }\r\n        })\r\n      },\r\n      saveDataruleForRole(){\r\n        if(!this.dataruleChecked || this.dataruleChecked.length==0){\r\n          this.$message.warning(\"请注意，现未勾选任何数据权限!\")\r\n        }\r\n        let params = {\r\n          permissionId:this.functionId,\r\n          roleId:this.roleId,\r\n          dataRuleIds:this.dataruleChecked.join(\",\")\r\n        }\r\n        console.log(\"保存数据权限\",params)\r\n        postAction(this.url.datarule,params).then(res=>{\r\n          if(res.success){\r\n            this.$message.success(res.message)\r\n          }else{\r\n            this.$message.error(res.message)\r\n          }\r\n        })\r\n      },\r\n      show(functionId,departId,roleId){\r\n        this.onReset()\r\n        this.departId = departId\r\n        this.functionId = functionId\r\n        this.roleId = roleId\r\n        this.visible=true\r\n        this.loadData()\r\n      },\r\n      onClose(){\r\n        this.visible=false\r\n        this.onReset()\r\n      },\r\n      onTabChange (key) {\r\n        this.activeTabKey = key\r\n      },\r\n      onReset(){\r\n        this.functionId=''\r\n        this.roleId=''\r\n        this.dataruleList=[]\r\n        this.dataruleChecked=[]\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped>\r\n\r\n</style>"]}]}