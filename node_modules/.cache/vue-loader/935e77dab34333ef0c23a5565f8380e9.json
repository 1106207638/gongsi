{"remainingRequest":"D:\\vue\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\vue\\src\\views\\system\\modules\\UserRecycleBinModal.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\vue\\src\\views\\system\\modules\\UserRecycleBinModal.vue","mtime":1615948821525},{"path":"D:\\vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1615952641464},{"path":"D:\\vue\\node_modules\\babel-loader\\lib\\index.js","mtime":1615952610415},{"path":"D:\\vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1615952641464},{"path":"D:\\vue\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader\\lib\\index.js","mtime":1615952643260}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IHB1dEFjdGlvbixkZWxldGVBY3Rpb24sZ2V0RmlsZUFjY2Vzc0h0dHBVcmwgfSBmcm9tICJAL2FwaS9tYW5hZ2UiCgovLyDpq5jluqblsIHoo4XnmoTor7fmsYLvvIzor7fliqHlv4Xkvb/nlKggc3VwZXJSZXF1ZXN0LmNhbGwodGhpcyx7fSkg55qE5pa55byP6LCD55SoCmZ1bmN0aW9uIHN1cGVyUmVxdWVzdChvcHRpb25zKSB7CiAgdGhpcy5sb2FkaW5nID0gISFvcHRpb25zLmxvYWRpbmcKICBvcHRpb25zLnByb21pc2UudGhlbihyZXMgPT4gewogICAgaWYgKHJlcy5zdWNjZXNzICYmIHR5cGVvZiBvcHRpb25zLnN1Y2Nlc3MgPT09ICdmdW5jdGlvbicpIHsKICAgICAgb3B0aW9ucy5zdWNjZXNzKHJlcykKICAgIH0gZWxzZSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihyZXMubWVzc2FnZSkKICAgIH0KICB9KS5jYXRjaChlID0+IHsKICAgIGNvbnNvbGUuZXJyb3IoJ+afpeivouW3suWIoOmZpOeahOeUqOaIt+Wksei0pe+8micsIGUpCiAgICB0aGlzLiRtZXNzYWdlLndhcm5pbmcoJ+afpeivouW3suWIoOmZpOeahOeUqOaIt+Wksei0pe+8micgKyAoZS5tZXNzYWdlIHx8IGUpKQogIH0pLmZpbmFsbHkoKCkgPT4gewogICAgdGhpcy5sb2FkaW5nID0gZmFsc2UKICB9KQp9CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ1VzZXJSZWN5Y2xlQmluTW9kYWwnLAogIHByb3BzOiB7CiAgICB2aXNpYmxlOiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICB9LAogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHRpdGxlOiAn55So5oi35Zue5pS256uZJywKICAgICAgbG9hZGluZzogZmFsc2UsCiAgICAgIGlubmVyVmlzaWJsZTogZmFsc2UsCiAgICAgIHNlbGVjdGVkUm93S2V5czogW10sCiAgICAgIGRhdGFTb3VyY2U6IFtdLAogICAgICBjb2x1bW5zOiBbCiAgICAgICAgeyB0aXRsZTogJyMnLCBhbGlnbjogJ2NlbnRlcicsIGtleTogJ3Jvd0luZGV4Jywgd2lkdGg6IDgwLCBjdXN0b21SZW5kZXI6ICh0LCByLCBpKSA9PiBpICsgMSB9LAogICAgICAgIHsgdGl0bGU6ICfotKblj7cnLCBhbGlnbjogJ2NlbnRlcicsIGRhdGFJbmRleDogJ3VzZXJuYW1lJyB9LAogICAgICAgIHsgdGl0bGU6ICflp5PlkI0nLCBhbGlnbjogJ2NlbnRlcicsIGRhdGFJbmRleDogJ3JlYWxuYW1lJywgfSwKICAgICAgICB7IHRpdGxlOiAn5aS05YOPJywgYWxpZ246ICdjZW50ZXInLCBkYXRhSW5kZXg6ICdhdmF0YXInLCBzY29wZWRTbG90czogeyBjdXN0b21SZW5kZXI6ICdhdmF0YXJzbG90JyB9IH0sCiAgICAgICAgeyB0aXRsZTogJ+mDqOmXqCcsIGFsaWduOiAnY2VudGVyJywgZGF0YUluZGV4OiAnb3JnQ29kZScgfSwKICAgICAgICB7IHRpdGxlOiAn5pON5L2cJywgYWxpZ246ICdjZW50ZXInLCBkYXRhSW5kZXg6ICdhY3Rpb24nLCB3aWR0aDogMjAwLCBzY29wZWRTbG90czogeyBjdXN0b21SZW5kZXI6ICdhY3Rpb24nIH0gfQogICAgICBdLAogICAgICB1cmw6IHsKICAgICAgICBnZXRBdmF0YXI6IChwYXRoKSA9PiBnZXRGaWxlQWNjZXNzSHR0cFVybChgJHtwYXRofWApLAogICAgICAgIC8vIOWbnuaUtuermeaTjeS9nO+8jGdldCA9IOiOt+WPluWIl+ihqO+8m3B1dCA9IOWPluWbnu+8m2RlbGV0ZSA9IOW9u+W6leWIoOmZpAogICAgICAgIHJlY3ljbGVCaW46ICcvc3lzL3VzZXIvcmVjeWNsZUJpbicsCiAgICAgICAgcHV0UmVjeWNsZUJpbjogJy9zeXMvdXNlci9wdXRSZWN5Y2xlQmluJywKICAgICAgICBkZWxldGVSZWN5Y2xlQmluOiAnL3N5cy91c2VyL2RlbGV0ZVJlY3ljbGVCaW4nLAogICAgICB9LAogICAgfQogIH0sCiAgd2F0Y2g6IHsKICAgIHZpc2libGU6IHsKICAgICAgaW1tZWRpYXRlOiB0cnVlLAogICAgICBoYW5kbGVyKHZhbCkgewogICAgICAgIGlmICh2YWwpIHsKICAgICAgICAgIHRoaXMubG9hZERhdGEoKQogICAgICAgIH0KICAgICAgICB0aGlzLmlubmVyVmlzaWJsZSA9IHZhbAogICAgICB9CiAgICB9LAogICAgaW5uZXJWaXNpYmxlKHZhbCkgewogICAgICB0aGlzLiRlbWl0KCd1cGRhdGU6dmlzaWJsZScsIHZhbCkKICAgIH0sCiAgfSwKICBtZXRob2RzOiB7CiAgICBsb2FkRGF0YSgpIHsKICAgICAgc3VwZXJSZXF1ZXN0LmNhbGwodGhpcywgewogICAgICAgIGxvYWRpbmc6IHRydWUsCiAgICAgICAgcHJvbWlzZTogdGhpcy4kaHR0cC5nZXQodGhpcy51cmwucmVjeWNsZUJpbiksCiAgICAgICAgc3VjY2VzczogcmVzID0+IHRoaXMuZGF0YVNvdXJjZSA9IHJlcy5yZXN1bHQKICAgICAgfSkKICAgIH0sCiAgICBoYW5kbGVPaygpIHsKICAgICAgdGhpcy5sb2FkRGF0YSgpCiAgICAgIHRoaXMuJGVtaXQoJ29rJykKICAgIH0sCiAgICBoYW5kbGVDYW5jZWwoKSB7CiAgICAgIHRoaXMuaW5uZXJWaXNpYmxlID0gZmFsc2UKICAgIH0sCiAgICAvLyDov5jljp/nlKjmiLcKICAgIGhhbmRsZVJldmVydCh1c2VySWRzKSB7CiAgICAgIHRoaXMuJGNvbmZpcm0oewogICAgICAgIHRpdGxlOiAn5oGi5aSN55So5oi3JywKICAgICAgICBjb250ZW50OiBg5oKo56Gu5a6a6KaB5oGi5aSN6L+ZICR7dXNlcklkcy5sZW5ndGh9IOS4queUqOaIt+WQl++8n2AsCiAgICAgICAgY2VudGVyZWQ6IHRydWUsCiAgICAgICAgb25PazogKCkgPT4gewogICAgICAgICAgcHV0QWN0aW9uKHRoaXMudXJsLnB1dFJlY3ljbGVCaW4se3VzZXJJZHM6dXNlcklkcy5qb2luKCcsJyl9KS50aGVuKChyZXMpPT57CiAgICAgICAgICAgIGlmKHJlcy5zdWNjZXNzKXsKICAgICAgICAgICAgICB0aGlzLmhhbmRsZU9rKCkKICAgICAgICAgICAgICB0aGlzLmhhbmRsZUNsZWFyU2VsZWN0aW9uKCkKICAgICAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoYOi/mOWOnyAke3VzZXJJZHMubGVuZ3RofSDkuKrnlKjmiLfmiJDlip/vvIFgKQogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgfSkKICAgIH0sCiAgICAvLyDlvbvlupXliKDpmaTnlKjmiLcKICAgIGhhbmRsZURlbGV0ZSh1c2VySWRzKSB7CiAgICAgIHRoaXMuJGNvbmZpcm0oewogICAgICAgIHRpdGxlOiAn5b275bqV5Yig6Zmk55So5oi3JywKICAgICAgICBjb250ZW50OiAoPGRpdj4KICAgICAgICAgIDxwPuaCqOehruWumuimgeW9u+W6leWIoOmZpOi/mSB7dXNlcklkcy5sZW5ndGh9IOS4queUqOaIt+WQl++8nzwvcD4KICAgICAgICAgIDxwIHN0eWxlPSJjb2xvcjpyZWQ7Ij7ms6jmhI/vvJrlvbvlupXliKDpmaTlkI7lsIbml6Dms5XmgaLlpI3vvIzor7fosKjmhY7mk43kvZzvvIE8L3A+CiAgICAgICAgPC9kaXY+KSwKICAgICAgICBjZW50ZXJlZDogdHJ1ZSwKICAgICAgICBvbk9rOiAoKSA9PiB7CiAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7CiAgICAgICAgICBkZWxldGVBY3Rpb24odGhhdC51cmwuZGVsZXRlUmVjeWNsZUJpbiwge3VzZXJJZHM6IHVzZXJJZHMuam9pbignLCcpfSkudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgIGlmIChyZXMuc3VjY2VzcykgewogICAgICAgICAgICAgIHRoaXMubG9hZERhdGEoKQogICAgICAgICAgICAgIHRoaXMuaGFuZGxlQ2xlYXJTZWxlY3Rpb24oKQogICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcyhg5b275bqV5Yig6ZmkICR7dXNlcklkcy5sZW5ndGh9IOS4queUqOaIt+aIkOWKn++8gWApCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhhdC4kbWVzc2FnZS53YXJuaW5nKHJlcy5tZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgfSkKICAgIH0sCiAgICBoYW5kbGVSZXZlcnRCYXRjaCgpIHsKICAgICAgdGhpcy5oYW5kbGVSZXZlcnQodGhpcy5zZWxlY3RlZFJvd0tleXMpCiAgICB9LAogICAgaGFuZGxlRGVsZXRlQmF0Y2goKSB7CiAgICAgIHRoaXMuaGFuZGxlRGVsZXRlKHRoaXMuc2VsZWN0ZWRSb3dLZXlzKQogICAgfSwKICAgIGhhbmRsZUNsZWFyU2VsZWN0aW9uKCkgewogICAgICB0aGlzLmhhbmRsZVRhYmxlU2VsZWN0Q2hhbmdlKFtdLCBbXSkKICAgIH0sCiAgICBoYW5kbGVUYWJsZVNlbGVjdENoYW5nZShzZWxlY3RlZFJvd0tleXMsIHNlbGVjdGlvblJvd3MpIHsKICAgICAgdGhpcy5zZWxlY3RlZFJvd0tleXMgPSBzZWxlY3RlZFJvd0tleXMKICAgICAgdGhpcy5zZWxlY3Rpb25Sb3dzID0gc2VsZWN0aW9uUm93cwogICAgfSwKICB9Cn0K"},{"version":3,"sources":["UserRecycleBinModal.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuDA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"UserRecycleBinModal.vue","sourceRoot":"src/views/system/modules","sourcesContent":["<template>\r\n  <a-modal\r\n    :width=\"1000\"\r\n    :title=\"title\"\r\n    :visible=\"innerVisible\"\r\n    @cancel=\"handleCancel\"\r\n    cancelText=\"关闭\"\r\n    :okButtonProps=\"{style:{display:'none'}}\"\r\n  >\r\n    <a-alert type=\"info\" showIcon style=\"margin-bottom: 16px;\">\r\n      <template slot=\"message\">\r\n        <span>已选择</span>\r\n        <a style=\"font-weight: 600;padding: 0 4px;\">{{ selectedRowKeys.length }}</a>\r\n        <span>项</span>\r\n        <template v-if=\"selectedRowKeys.length>0\">\r\n          <a-divider type=\"vertical\"/>\r\n          <a @click=\"handleClearSelection\">清空选择</a>\r\n          <a-divider type=\"vertical\"/>\r\n          <a @click=\"handleRevertBatch\">批量还原</a>\r\n          <a-divider type=\"vertical\"/>\r\n          <a @click=\"handleDeleteBatch\">批量删除</a>\r\n        </template>\r\n      </template>\r\n    </a-alert>\r\n\r\n    <a-table\r\n      ref=\"table\"\r\n      rowKey=\"id\"\r\n      size=\"middle\"\r\n      bordered\r\n      :columns=\"columns\"\r\n      :loading=\"loading\"\r\n      :dataSource=\"dataSource\"\r\n      :pagination=\"false\"\r\n      :rowSelection=\"{selectedRowKeys, onChange: handleTableSelectChange}\"\r\n    >\r\n\r\n      <!-- 显示头像 -->\r\n      <template slot=\"avatarslot\" slot-scope=\"text, record, index\">\r\n        <div class=\"anty-img-wrap\">\r\n          <a-avatar shape=\"square\" :src=\"url.getAvatar(record.avatar)\" icon=\"user\"/>\r\n        </div>\r\n      </template>\r\n\r\n      <span slot=\"action\" slot-scope=\"text, record\">\r\n        <a @click=\"handleRevert([record.id])\"><a-icon type=\"redo\"/> 还原用户</a>\r\n        <a-divider type=\"vertical\"/>\r\n        <a @click=\"handleDelete([record.id])\"><a-icon type=\"delete\"/> 彻底删除</a>\r\n      </span>\r\n    </a-table>\r\n\r\n  </a-modal>\r\n</template>\r\n\r\n<script>\r\n  import { putAction,deleteAction,getFileAccessHttpUrl } from \"@/api/manage\"\r\n\r\n  // 高度封装的请求，请务必使用 superRequest.call(this,{}) 的方式调用\r\n  function superRequest(options) {\r\n    this.loading = !!options.loading\r\n    options.promise.then(res => {\r\n      if (res.success && typeof options.success === 'function') {\r\n        options.success(res)\r\n      } else {\r\n        throw new Error(res.message)\r\n      }\r\n    }).catch(e => {\r\n      console.error('查询已删除的用户失败：', e)\r\n      this.$message.warning('查询已删除的用户失败：' + (e.message || e))\r\n    }).finally(() => {\r\n      this.loading = false\r\n    })\r\n  }\r\n\r\n  export default {\r\n    name: 'UserRecycleBinModal',\r\n    props: {\r\n      visible: {\r\n        type: Boolean,\r\n        default: false\r\n      },\r\n    },\r\n    data() {\r\n      return {\r\n        title: '用户回收站',\r\n        loading: false,\r\n        innerVisible: false,\r\n        selectedRowKeys: [],\r\n        dataSource: [],\r\n        columns: [\r\n          { title: '#', align: 'center', key: 'rowIndex', width: 80, customRender: (t, r, i) => i + 1 },\r\n          { title: '账号', align: 'center', dataIndex: 'username' },\r\n          { title: '姓名', align: 'center', dataIndex: 'realname', },\r\n          { title: '头像', align: 'center', dataIndex: 'avatar', scopedSlots: { customRender: 'avatarslot' } },\r\n          { title: '部门', align: 'center', dataIndex: 'orgCode' },\r\n          { title: '操作', align: 'center', dataIndex: 'action', width: 200, scopedSlots: { customRender: 'action' } }\r\n        ],\r\n        url: {\r\n          getAvatar: (path) => getFileAccessHttpUrl(`${path}`),\r\n          // 回收站操作，get = 获取列表；put = 取回；delete = 彻底删除\r\n          recycleBin: '/sys/user/recycleBin',\r\n          putRecycleBin: '/sys/user/putRecycleBin',\r\n          deleteRecycleBin: '/sys/user/deleteRecycleBin',\r\n        },\r\n      }\r\n    },\r\n    watch: {\r\n      visible: {\r\n        immediate: true,\r\n        handler(val) {\r\n          if (val) {\r\n            this.loadData()\r\n          }\r\n          this.innerVisible = val\r\n        }\r\n      },\r\n      innerVisible(val) {\r\n        this.$emit('update:visible', val)\r\n      },\r\n    },\r\n    methods: {\r\n      loadData() {\r\n        superRequest.call(this, {\r\n          loading: true,\r\n          promise: this.$http.get(this.url.recycleBin),\r\n          success: res => this.dataSource = res.result\r\n        })\r\n      },\r\n      handleOk() {\r\n        this.loadData()\r\n        this.$emit('ok')\r\n      },\r\n      handleCancel() {\r\n        this.innerVisible = false\r\n      },\r\n      // 还原用户\r\n      handleRevert(userIds) {\r\n        this.$confirm({\r\n          title: '恢复用户',\r\n          content: `您确定要恢复这 ${userIds.length} 个用户吗？`,\r\n          centered: true,\r\n          onOk: () => {\r\n            putAction(this.url.putRecycleBin,{userIds:userIds.join(',')}).then((res)=>{\r\n              if(res.success){\r\n                this.handleOk()\r\n                this.handleClearSelection()\r\n                this.$message.success(`还原 ${userIds.length} 个用户成功！`)\r\n              }\r\n            })\r\n          }\r\n        })\r\n      },\r\n      // 彻底删除用户\r\n      handleDelete(userIds) {\r\n        this.$confirm({\r\n          title: '彻底删除用户',\r\n          content: (<div>\r\n            <p>您确定要彻底删除这 {userIds.length} 个用户吗？</p>\r\n            <p style=\"color:red;\">注意：彻底删除后将无法恢复，请谨慎操作！</p>\r\n          </div>),\r\n          centered: true,\r\n          onOk: () => {\r\n            var that = this;\r\n            deleteAction(that.url.deleteRecycleBin, {userIds: userIds.join(',')}).then((res) => {\r\n              if (res.success) {\r\n                this.loadData()\r\n                this.handleClearSelection()\r\n                this.$message.success(`彻底删除 ${userIds.length} 个用户成功！`)\r\n              } else {\r\n                that.$message.warning(res.message);\r\n              }\r\n            });\r\n          },\r\n        })\r\n      },\r\n      handleRevertBatch() {\r\n        this.handleRevert(this.selectedRowKeys)\r\n      },\r\n      handleDeleteBatch() {\r\n        this.handleDelete(this.selectedRowKeys)\r\n      },\r\n      handleClearSelection() {\r\n        this.handleTableSelectChange([], [])\r\n      },\r\n      handleTableSelectChange(selectedRowKeys, selectionRows) {\r\n        this.selectedRowKeys = selectedRowKeys\r\n        this.selectionRows = selectionRows\r\n      },\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"less\" scoped></style>"]}]}