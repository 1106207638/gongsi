{"remainingRequest":"D:\\vue\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\vue\\src\\views\\system\\modules\\DeptRoleUserModal.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\vue\\src\\views\\system\\modules\\DeptRoleUserModal.vue","mtime":1615948821489},{"path":"D:\\vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1615952641464},{"path":"D:\\vue\\node_modules\\babel-loader\\lib\\index.js","mtime":1615952610415},{"path":"D:\\vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1615952641464},{"path":"D:\\vue\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader\\lib\\index.js","mtime":1615952643260}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7aHR0cEFjdGlvbiwgZ2V0QWN0aW9ufSBmcm9tICdAL2FwaS9tYW5hZ2UnCmltcG9ydCAgSkVsbGlwc2lzICBmcm9tICdAL2NvbXBvbmVudHMvamVlY2cvSkVsbGlwc2lzJwppbXBvcnQge2luaXREaWN0T3B0aW9uc30gZnJvbSAnQC9jb21wb25lbnRzL2RpY3QvSkRpY3RTZWxlY3RVdGlsJwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdEZXB0Um9sZVVzZXJNb2RhbCcsCiAgY29tcG9uZW50czogewogICAgSkVsbGlwc2lzCiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgY3VycmVudERlcHRJZDoiIiwKICAgICAgdGl0bGU6ICLpg6jpl6jop5LoibLliIbphY0iLAogICAgICB2aXNpYmxlOiBmYWxzZSwKICAgICAgbW9kZWw6IHt9LAogICAgICBsYWJlbENvbDogewogICAgICAgIHhzOiB7c3BhbjogMjR9LAogICAgICAgIHNtOiB7c3BhbjogNX0sCiAgICAgIH0sCiAgICAgIHdyYXBwZXJDb2w6IHsKICAgICAgICB4czoge3NwYW46IDI0fSwKICAgICAgICBzbToge3NwYW46IDE2fSwKICAgICAgfSwKICAgICAgY29uZmlybUxvYWRpbmc6IGZhbHNlLAogICAgICBmb3JtOiB0aGlzLiRmb3JtLmNyZWF0ZUZvcm0odGhpcyksCiAgICAgIHZhbGlkYXRvclJ1bGVzOiB7fSwKICAgICAgdXJsOiB7CiAgICAgICAgYWRkOiAiL3N5cy9zeXNEZXBhcnRSb2xlL2RlcHRSb2xlVXNlckFkZCIsCiAgICAgICAgZ2V0RGVwdFJvbGVMaXN0OiIvc3lzL3N5c0RlcGFydFJvbGUvZ2V0RGVwdFJvbGVMaXN0IiwKICAgICAgICBnZXREZXB0Um9sZUJ5VXNlcklkOiIvc3lzL3N5c0RlcGFydFJvbGUvZ2V0RGVwdFJvbGVCeVVzZXJJZCIKICAgICAgfSwKICAgICAgZGVzaWduTmFtZU9wdGlvbjogW10sCiAgICAgIHVzZXJJZDogIiIsCiAgICAgIG5ld1JvbGVJZDoiIiwKICAgICAgb2xkUm9sZUlkOiIiLAogICAgICBkZXNpZ25OYW1lVmFsdWU6W10sCiAgICAgIGRlc2Zvcm1MaXN0OiBbXSwKICAgIH0KICB9LAogIGNyZWF0ZWQoKSB7CgogIH0sCiAgbWV0aG9kczogewogICAgYWRkKHJlY29yZCxkZXBhcnRJZCkgewogICAgICB0aGlzLnVzZXJJZCA9IHJlY29yZC5pZDsKICAgICAgdGhpcy5jdXJyZW50RGVwdElkID0gZGVwYXJ0SWQ7CiAgICAgIHRoaXMubG9hZERlc2Zvcm1MaXN0KCk7CiAgICAgIHRoaXMuZWRpdCh7fSk7CiAgICB9LAogICAgZWRpdChyZWNvcmQpIHsKICAgICAgdGhpcy5mb3JtLnJlc2V0RmllbGRzKCk7CiAgICAgIHRoaXMubW9kZWwgPSBPYmplY3QuYXNzaWduKHt9LCByZWNvcmQpOwogICAgICB0aGlzLnZpc2libGUgPSB0cnVlOwogICAgICBnZXRBY3Rpb24odGhpcy51cmwuZ2V0RGVwdFJvbGVCeVVzZXJJZCx7dXNlcklkOnRoaXMudXNlcklkLGRlcGFydElkOnRoaXMuY3VycmVudERlcHRJZH0pLnRoZW4oKHJlcykgPT4gewogICAgICAgIGlmIChyZXMuc3VjY2VzcykgewogICAgICAgICAgdmFyIGRlc2lnbk5hbWUgPSBbXTsKICAgICAgICAgIGZvciAobGV0IHZhbHVlIG9mIHJlcy5yZXN1bHQpIHsKICAgICAgICAgICAgZGVzaWduTmFtZS5wdXNoKHZhbHVlLmRyb2xlSWQpCiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLm9sZFJvbGVJZD1kZXNpZ25OYW1lLmpvaW4oIiwiKTsKICAgICAgICAgIHRoaXMuZGVzaWduTmFtZVZhbHVlID0gZGVzaWduTmFtZTsKICAgICAgICAgIHRoaXMubmV3Um9sZUlkID0gZGVzaWduTmFtZS5qb2luKCIsIik7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBjbG9zZSgpIHsKICAgICAgdGhpcy4kZW1pdCgnY2xvc2UnKTsKICAgICAgdGhpcy52aXNpYmxlID0gZmFsc2U7CiAgICB9LAogICAgaGFuZGxlU3VibWl0KCkgewogICAgICBjb25zdCB0aGF0ID0gdGhpczsKICAgICAgLy8g6Kem5Y+R6KGo5Y2V6aqM6K+BCiAgICAgIHRoYXQuY29uZmlybUxvYWRpbmcgPSB0cnVlOwogICAgICBsZXQgIGh0dHB1cmwgPSB0aGlzLnVybC5hZGQ7CiAgICAgIGxldCAgbWV0aG9kID0gJ3Bvc3QnOwogICAgICBsZXQgZm9ybURhdGEgPSBPYmplY3QuYXNzaWduKHRoaXMubW9kZWwsIHt9KTsKICAgICAgLy/ml7bpl7TmoLzlvI/ljJYKICAgICAgZm9ybURhdGEudXNlcklkID0gdGhpcy51c2VySWQ7CiAgICAgIGZvcm1EYXRhLm5ld1JvbGVJZD10aGlzLm5ld1JvbGVJZDsKICAgICAgZm9ybURhdGEub2xkUm9sZUlkPXRoaXMub2xkUm9sZUlkOwogICAgICBodHRwQWN0aW9uKGh0dHB1cmwsIGZvcm1EYXRhLCBtZXRob2QpLnRoZW4oKHJlcykgPT4gewogICAgICAgIGlmIChyZXMuc3VjY2VzcykgewogICAgICAgICAgdGhhdC4kbWVzc2FnZS5zdWNjZXNzKHJlcy5tZXNzYWdlKTsKICAgICAgICAgIHRoYXQuJGVtaXQoJ3JlbG9hZCcpOwogICAgICAgICAgdGhhdC4kZW1pdCgnb2snKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhhdC4kbWVzc2FnZS53YXJuaW5nKHJlcy5tZXNzYWdlKTsKICAgICAgICB9CiAgICAgIH0pLmZpbmFsbHkoKCkgPT4gewogICAgICAgIHRoYXQuY29uZmlybUxvYWRpbmcgPSBmYWxzZTsKICAgICAgICB0aGF0LmNsb3NlKCk7CiAgICAgIH0pCiAgICB9LAogICAgaGFuZGxlQ2FuY2VsKCkgewogICAgICB0aGlzLmRlc2lnbk5hbWVPcHRpb249W107CiAgICAgIHRoaXMuZGVzaWduTmFtZVZhbHVlPVtdOwogICAgICB0aGlzLmNsb3NlKCkKICAgIH0sCiAgICBkZXNpZ25OYW1lQ2hhbmdlKHNlbGVjdGVkVmFsdWUpIHsKICAgICAgdGhpcy5uZXdSb2xlSWQ9c2VsZWN0ZWRWYWx1ZS5qb2luKCIsIik7CiAgICB9LAogICAgY2hlY2tBTEwoKXsKICAgICAgdmFyIGRlc2lnbk5hbWUgPSBbXTsKICAgICAgZm9yIChsZXQgdmFsdWUgb2YgdGhpcy5kZXNmb3JtTGlzdCkgewogICAgICAgIGRlc2lnbk5hbWUucHVzaCgKICAgICAgICAgIHZhbHVlLmlkCiAgICAgICAgKQogICAgICB9CiAgICAgIHRoaXMuZGVzaWduTmFtZVZhbHVlID0gZGVzaWduTmFtZTsKICAgICAgdGhpcy5uZXdSb2xlSWQ9ZGVzaWduTmFtZS5qb2luKCIsIik7CiAgICB9LAogICAgY2FuY2VsQ2hlY2tBTEwoKXsKICAgICAgdGhpcy5kZXNpZ25OYW1lVmFsdWU9W107CiAgICAgIHRoaXMubmV3Um9sZUlkPSIiOwogICAgfSwKICAgIC8qKiDliqDovb1kZXNmb3JtICovCiAgICBsb2FkRGVzZm9ybUxpc3QoKSB7CiAgICAgIGdldEFjdGlvbih0aGlzLnVybC5nZXREZXB0Um9sZUxpc3QsIHsgZGVwYXJ0SWQ6IHRoaXMuY3VycmVudERlcHRJZCwgdXNlcklkOnRoaXMudXNlcklkIH0pLnRoZW4oKHJlcykgPT4gewogICAgICAgIGlmIChyZXMuc3VjY2VzcykgewogICAgICAgICAgdGhpcy5kZXNmb3JtTGlzdCA9IHJlcy5yZXN1bHQKICAgICAgICAgIHZhciBkZXNpZ25OYW1lID0gW107CiAgICAgICAgICBmb3IgKGxldCB2YWx1ZSBvZiB0aGlzLmRlc2Zvcm1MaXN0KSB7CiAgICAgICAgICAgIGRlc2lnbk5hbWUucHVzaCh7CiAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLmlkLAogICAgICAgICAgICAgIHRleHQ6IHZhbHVlLnJvbGVOYW1lLAogICAgICAgICAgICB9KQogICAgICAgICAgfQogICAgICAgICAgdGhpcy5kZXNpZ25OYW1lT3B0aW9uID0gZGVzaWduTmFtZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICB9Cgp9Cg=="},{"version":3,"sources":["DeptRoleUserModal.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmDA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA","file":"DeptRoleUserModal.vue","sourceRoot":"src/views/system/modules","sourcesContent":["<template>\r\n  <a-drawer\r\n    :title=\"title\"\r\n    :maskClosable=\"true\"\r\n    width=600\r\n    placement=\"right\"\r\n    :closable=\"true\"\r\n    @close=\"close\"\r\n    :visible=\"visible\"\r\n    style=\"overflow: auto;padding-bottom: 53px;\">\r\n\r\n    <a-spin :spinning=\"confirmLoading\">\r\n\r\n      <a-form :form=\"form\" v-if=\"designNameOption.length>0\">\r\n        <a-form-item label=''>\r\n          <a-col :xl=\"24\" :lg=\"24\" :md=\"24\" :sm=\"24\" :xs=\"24\">\r\n            <a-card :style=\"{ marginTop: '12px',height:'auto' }\">\r\n              <a-checkbox-group @change=\"designNameChange\" v-model=\"designNameValue\" style=\"width: 100%\">\r\n                <a-row>\r\n                  <template v-for=\"(des) in designNameOption\">\r\n                    <a-col :span=\"6\">\r\n                      <a-checkbox :value=\"des.value\">{{ des.text }}</a-checkbox>\r\n                    </a-col>\r\n                  </template>\r\n                </a-row>\r\n              </a-checkbox-group>\r\n            </a-card>\r\n          </a-col>\r\n        </a-form-item>\r\n      </a-form>\r\n      <div v-else><h3>无可配置角色!</h3></div>\r\n    </a-spin>\r\n    <div class=\"drawer-bootom-button\">\r\n      <a-dropdown style=\"float: left\" :trigger=\"['click']\" placement=\"topCenter\">\r\n        <a-menu slot=\"overlay\">\r\n          <a-menu-item key=\"1\" @click=\"checkALL\">全部勾选</a-menu-item>\r\n          <a-menu-item key=\"2\" @click=\"cancelCheckALL\">取消全选</a-menu-item>\r\n        </a-menu>\r\n        <a-button>\r\n          操作 <a-icon type=\"up\" />\r\n        </a-button>\r\n      </a-dropdown>\r\n      <a-popconfirm  title=\"确定放弃编辑？\" @confirm=\"close\" okText=\"确定\" cancelText=\"取消\">\r\n        <a-button style=\"margin-right: .8rem\">取消</a-button>\r\n      </a-popconfirm>\r\n      <a-button @click=\"handleSubmit(true)\" type=\"primary\">保存</a-button>\r\n    </div>\r\n  </a-drawer>\r\n</template>\r\n\r\n<script>\r\n  import {httpAction, getAction} from '@/api/manage'\r\n  import  JEllipsis  from '@/components/jeecg/JEllipsis'\r\n  import {initDictOptions} from '@/components/dict/JDictSelectUtil'\r\n\r\n  export default {\r\n    name: 'DeptRoleUserModal',\r\n    components: {\r\n      JEllipsis\r\n    },\r\n    data() {\r\n      return {\r\n        currentDeptId:\"\",\r\n        title: \"部门角色分配\",\r\n        visible: false,\r\n        model: {},\r\n        labelCol: {\r\n          xs: {span: 24},\r\n          sm: {span: 5},\r\n        },\r\n        wrapperCol: {\r\n          xs: {span: 24},\r\n          sm: {span: 16},\r\n        },\r\n        confirmLoading: false,\r\n        form: this.$form.createForm(this),\r\n        validatorRules: {},\r\n        url: {\r\n          add: \"/sys/sysDepartRole/deptRoleUserAdd\",\r\n          getDeptRoleList:\"/sys/sysDepartRole/getDeptRoleList\",\r\n          getDeptRoleByUserId:\"/sys/sysDepartRole/getDeptRoleByUserId\"\r\n        },\r\n        designNameOption: [],\r\n        userId: \"\",\r\n        newRoleId:\"\",\r\n        oldRoleId:\"\",\r\n        designNameValue:[],\r\n        desformList: [],\r\n      }\r\n    },\r\n    created() {\r\n\r\n    },\r\n    methods: {\r\n      add(record,departId) {\r\n        this.userId = record.id;\r\n        this.currentDeptId = departId;\r\n        this.loadDesformList();\r\n        this.edit({});\r\n      },\r\n      edit(record) {\r\n        this.form.resetFields();\r\n        this.model = Object.assign({}, record);\r\n        this.visible = true;\r\n        getAction(this.url.getDeptRoleByUserId,{userId:this.userId,departId:this.currentDeptId}).then((res) => {\r\n          if (res.success) {\r\n            var designName = [];\r\n            for (let value of res.result) {\r\n              designName.push(value.droleId)\r\n            }\r\n            this.oldRoleId=designName.join(\",\");\r\n            this.designNameValue = designName;\r\n            this.newRoleId = designName.join(\",\");\r\n          }\r\n        });\r\n      },\r\n      close() {\r\n        this.$emit('close');\r\n        this.visible = false;\r\n      },\r\n      handleSubmit() {\r\n        const that = this;\r\n        // 触发表单验证\r\n        that.confirmLoading = true;\r\n        let  httpurl = this.url.add;\r\n        let  method = 'post';\r\n        let formData = Object.assign(this.model, {});\r\n        //时间格式化\r\n        formData.userId = this.userId;\r\n        formData.newRoleId=this.newRoleId;\r\n        formData.oldRoleId=this.oldRoleId;\r\n        httpAction(httpurl, formData, method).then((res) => {\r\n          if (res.success) {\r\n            that.$message.success(res.message);\r\n            that.$emit('reload');\r\n            that.$emit('ok');\r\n          } else {\r\n            that.$message.warning(res.message);\r\n          }\r\n        }).finally(() => {\r\n          that.confirmLoading = false;\r\n          that.close();\r\n        })\r\n      },\r\n      handleCancel() {\r\n        this.designNameOption=[];\r\n        this.designNameValue=[];\r\n        this.close()\r\n      },\r\n      designNameChange(selectedValue) {\r\n        this.newRoleId=selectedValue.join(\",\");\r\n      },\r\n      checkALL(){\r\n        var designName = [];\r\n        for (let value of this.desformList) {\r\n          designName.push(\r\n            value.id\r\n          )\r\n        }\r\n        this.designNameValue = designName;\r\n        this.newRoleId=designName.join(\",\");\r\n      },\r\n      cancelCheckALL(){\r\n        this.designNameValue=[];\r\n        this.newRoleId=\"\";\r\n      },\r\n      /** 加载desform */\r\n      loadDesformList() {\r\n        getAction(this.url.getDeptRoleList, { departId: this.currentDeptId, userId:this.userId }).then((res) => {\r\n          if (res.success) {\r\n            this.desformList = res.result\r\n            var designName = [];\r\n            for (let value of this.desformList) {\r\n              designName.push({\r\n                value: value.id,\r\n                text: value.roleName,\r\n              })\r\n            }\r\n            this.designNameOption = designName;\r\n          }\r\n        });\r\n      },\r\n    }\r\n\r\n  }\r\n</script>\r\n\r\n<style scoped>\r\n  .drawer-bootom-button {\r\n    position: absolute;\r\n    bottom: 0;\r\n    width: 100%;\r\n    border-top: 1px solid #e8e8e8;\r\n    padding: 10px 16px;\r\n    text-align: right;\r\n    left: 0;\r\n    background: #fff;\r\n    border-radius: 0 0 2px 2px;\r\n  }\r\n</style>"]}]}