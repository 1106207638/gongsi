{"remainingRequest":"D:\\vue\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\vue\\src\\components\\JVxeCells\\JVxeFileCell.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\vue\\src\\components\\JVxeCells\\JVxeFileCell.vue","mtime":1615948813428},{"path":"D:\\vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1615952641464},{"path":"D:\\vue\\node_modules\\babel-loader\\lib\\index.js","mtime":1615952610415},{"path":"D:\\vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1615952641464},{"path":"D:\\vue\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader\\lib\\index.js","mtime":1615952643260}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGdldEZpbGVBY2Nlc3NIdHRwVXJsIH0gZnJvbSAnQGFwaS9tYW5hZ2UnCmltcG9ydCBKVnhlQ2VsbE1peGlucyBmcm9tICdAL2NvbXBvbmVudHMvamVlY2cvSlZ4ZVRhYmxlL21peGlucy9KVnhlQ2VsbE1peGlucycKaW1wb3J0IHsgQUNDRVNTX1RPS0VOIH0gZnJvbSAnQC9zdG9yZS9tdXRhdGlvbi10eXBlcycKaW1wb3J0IEpGaWxlUG9wIGZyb20gJ0AvY29tcG9uZW50cy9qZWVjZy9taW5pcG9wL0pGaWxlUG9wJwoKaW1wb3J0IEpWeGVVcGxvYWRDZWxsIGZyb20gJ0AvY29tcG9uZW50cy9qZWVjZy9KVnhlVGFibGUvY29tcG9uZW50cy9jZWxscy9KVnhlVXBsb2FkQ2VsbCcKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnSlZ4ZUZpbGVDZWxsJywKICBtaXhpbnM6IFtKVnhlQ2VsbE1peGluc10sCiAgY29tcG9uZW50czoge0pGaWxlUG9wfSwKICBwcm9wczoge30sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGlubmVyRmlsZTogbnVsbCwKICAgICAgbnVtYmVyOjAsCiAgICB9CiAgfSwKICBjb21wdXRlZDogewogICAgLyoqIHVwbG9hZCBoZWFkZXJzICovCiAgICB1cGxvYWRIZWFkZXJzKCkgewogICAgICBsZXQge29yaWdpbkNvbHVtbjogY29sfSA9IHRoaXMKICAgICAgbGV0IGhlYWRlcnMgPSB7fQogICAgICBpZiAoY29sLnRva2VuID09PSB0cnVlKSB7CiAgICAgICAgaGVhZGVyc1snWC1BY2Nlc3MtVG9rZW4nXSA9IHRoaXMuJGxzLmdldChBQ0NFU1NfVE9LRU4pCiAgICAgIH0KICAgICAgcmV0dXJuIGhlYWRlcnMKICAgIH0sCgogICAgLyoqIOS4iuS8oOivt+axguWcsOWdgCAqLwogICAgdXBsb2FkQWN0aW9uKCkgewogICAgICBpZiAoIXRoaXMub3JpZ2luQ29sdW1uLmFjdGlvbikgewogICAgICAgIHJldHVybiB3aW5kb3cuX0NPTkZJR1snZG9taWFuVVJMJ10gKyAnL3N5cy9jb21tb24vdXBsb2FkJwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB0aGlzLm9yaWdpbkNvbHVtbi5hY3Rpb24KICAgICAgfQogICAgfSwKCiAgICBoYXNGaWxlKCkgewogICAgICByZXR1cm4gdGhpcy5pbm5lckZpbGUgIT0gbnVsbAogICAgfSwKCiAgICBlbGxpcHNpc0ZpbGVOYW1lKCkgewogICAgICBsZXQgbGVuZ3RoID0gNQogICAgICBsZXQgZmlsZSA9IHRoaXMuaW5uZXJGaWxlCiAgICAgIGlmICghZmlsZSB8fCAhZmlsZS5uYW1lKSB7CiAgICAgICAgcmV0dXJuICcnCiAgICAgIH0KICAgICAgaWYgKGZpbGUubmFtZS5sZW5ndGggPiBsZW5ndGgpIHsKICAgICAgICByZXR1cm4gZmlsZS5uYW1lLnN1YnN0cigwLCBsZW5ndGgpICsgJ+KApicKICAgICAgfQogICAgICByZXR1cm4gZmlsZS5uYW1lCiAgICB9LAoKICAgIHJlc3BvbnNlTmFtZSgpIHsKICAgICAgaWYgKHRoaXMub3JpZ2luQ29sdW1uLnJlc3BvbnNlTmFtZSkgewogICAgICAgIHJldHVybiB0aGlzLm9yaWdpbkNvbHVtbi5yZXNwb25zZU5hbWUKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gJ21lc3NhZ2UnCiAgICAgIH0KICAgIH0sCgogIH0sCiAgd2F0Y2g6IHsKICAgIGlubmVyVmFsdWU6IHsKICAgICAgaW1tZWRpYXRlOiB0cnVlLAogICAgICBoYW5kbGVyKCkgewogICAgICAgIGlmICh0aGlzLmlubmVyVmFsdWUpIHsKICAgICAgICAgIHRoaXMuaW5uZXJGaWxlID0gdGhpcy5pbm5lclZhbHVlCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuaW5uZXJGaWxlID0gbnVsbAogICAgICAgIH0KICAgICAgfSwKICAgIH0sCiAgfSwKICBtZXRob2RzOiB7CgogICAgLy8g54K55Ye75pu05aSa5oyJ6ZKuCiAgICBoYW5kbGVNb3JlT3BlcmF0aW9uKG9yaWdpbkNvbHVtbikgewogICAgICAvL3VwZGF0ZS1iZWdpbi1hdXRob3I6d2FuZ3NodWFpIGRhdGU6MjAyMDEwMjEgZm9yOkxPV0NPRC05Njkg5Yik5pat5Lyg6L+H5p2l55qE5a2X5q615piv5ZCm5a2Y5ZyobnVtYmVy77yM55So5LqO5o6n5Yi25LiK5Lyg5paH5Lu2CiAgICAgIGlmIChvcmlnaW5Db2x1bW4ubnVtYmVyKSB7CiAgICAgICAgdGhpcy5udW1iZXIgPSBvcmlnaW5Db2x1bW4ubnVtYmVyCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5udW1iZXIgPSAwCiAgICAgIH0KICAgICAgLy91cGRhdGUtZW5kLWF1dGhvcjp3YW5nc2h1YWkgZGF0ZToyMDIwMTAyMSBmb3I6TE9XQ09ELTk2OSDliKTmlq3kvKDov4fmnaXnmoTlrZfmrrXmmK/lkKblrZjlnKhudW1iZXLvvIznlKjkuo7mjqfliLbkuIrkvKDmlofku7YKICAgICAgaWYob3JpZ2luQ29sdW1uICYmIG9yaWdpbkNvbHVtbi5maWVsZEV4dGVuZEpzb24pewogICAgICAgIGxldCBqc29uID0gSlNPTi5wYXJzZShvcmlnaW5Db2x1bW4uZmllbGRFeHRlbmRKc29uKTsKICAgICAgICB0aGlzLm51bWJlciA9IGpzb24udXBsb2FkbnVtP2pzb24udXBsb2FkbnVtOjA7CiAgICAgIH0KICAgICAgbGV0IHBhdGggPSAnJwogICAgICBpZiAodGhpcy5pbm5lckZpbGUpIHsKICAgICAgICBwYXRoID0gdGhpcy5pbm5lckZpbGUucGF0aAogICAgICB9CiAgICAgIHRoaXMuJHJlZnMuZmlsZVBvcC5zaG93KCcnLCBwYXRoKQogICAgfSwKCiAgICAvLyDmm7TlpJrkuIrkvKDlm57osIMKICAgIGhhbmRsZUZpbGVTdWNjZXNzKGZpbGUpIHsKICAgICAgaWYgKGZpbGUpIHsKICAgICAgICB0aGlzLmlubmVyRmlsZS5wYXRoID0gZmlsZS5wYXRoCiAgICAgICAgdGhpcy5oYW5kbGVDaGFuZ2VDb21tb24odGhpcy5pbm5lckZpbGUpCiAgICAgIH0KICAgIH0sCgogICAgaGFuZGxlQ2hhbmdlVXBsb2FkKGluZm8pIHsKICAgICAgbGV0IHtvcmlnaW5Db2x1bW46IGNvbH0gPSB0aGlzCiAgICAgIGxldCB7ZmlsZX0gPSBpbmZvCiAgICAgIGxldCB2YWx1ZSA9IHsKICAgICAgICBuYW1lOiBmaWxlLm5hbWUsCiAgICAgICAgdHlwZTogZmlsZS50eXBlLAogICAgICAgIHNpemU6IGZpbGUuc2l6ZSwKICAgICAgICBzdGF0dXM6IGZpbGUuc3RhdHVzLAogICAgICAgIHBlcmNlbnQ6IGZpbGUucGVyY2VudAogICAgICB9CiAgICAgIGlmIChmaWxlLnJlc3BvbnNlKSB7CiAgICAgICAgdmFsdWVbJ3Jlc3BvbnNlTmFtZSddID0gZmlsZS5yZXNwb25zZVt0aGlzLnJlc3BvbnNlTmFtZV0KICAgICAgfQogICAgICBpZiAoZmlsZS5zdGF0dXMgPT09ICdkb25lJykgewogICAgICAgIHZhbHVlWydwYXRoJ10gPSBmaWxlLnJlc3BvbnNlW3RoaXMucmVzcG9uc2VOYW1lXQogICAgICAgIHRoaXMuaGFuZGxlQ2hhbmdlQ29tbW9uKHZhbHVlKQogICAgICB9IGVsc2UgaWYgKGZpbGUuc3RhdHVzID09PSAnZXJyb3InKSB7CiAgICAgICAgdmFsdWVbJ21lc3NhZ2UnXSA9IGZpbGUucmVzcG9uc2UubWVzc2FnZSB8fCAn5pyq55+l6ZSZ6K+vJwogICAgICB9CiAgICAgIHRoaXMuaW5uZXJGaWxlID0gdmFsdWUKICAgIH0sCgogICAgaGFuZGxlQ2xpY2tEb3dubG9hZEZpbGUoKSB7CiAgICAgIGxldCB7dXJsLCBwYXRofSA9IHRoaXMuaW5uZXJGaWxlIHx8IHt9CiAgICAgIGlmICghdXJsIHx8IHVybC5sZW5ndGggPT09IDApIHsKICAgICAgICBpZiAocGF0aCAmJiBwYXRoLmxlbmd0aCA+IDApIHsKICAgICAgICAgIHVybCA9IGdldEZpbGVBY2Nlc3NIdHRwVXJsKHBhdGguc3BsaXQoJywnKVswXSkKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHVybCkgewogICAgICAgIHdpbmRvdy5vcGVuKHVybCkKICAgICAgfQogICAgfSwKCiAgICBoYW5kbGVDbGlja0RlbGV0ZUZpbGUoKSB7CiAgICAgIHRoaXMuaGFuZGxlQ2hhbmdlQ29tbW9uKG51bGwpCiAgICB9LAoKICB9LAogIC8vIOOAkOe7hOS7tuWinuW8uuOAkeazqOmHiuivpuinge+8mkpWeGVDZWxsTWl4aW5zLmpzCiAgZW5oYW5jZWQ6IHsKICAgIHN3aXRjaGVzOiB7dmlzaWJsZTogdHJ1ZX0sCiAgICBnZXRWYWx1ZTogdmFsdWUgPT4gSlZ4ZVVwbG9hZENlbGwuZW5oYW5jZWQuZ2V0VmFsdWUodmFsdWUpLAogICAgc2V0VmFsdWU6IHZhbHVlID0+IEpWeGVVcGxvYWRDZWxsLmVuaGFuY2VkLnNldFZhbHVlKHZhbHVlKSwKICB9Cn0K"},{"version":3,"sources":["JVxeFileCell.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8DA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"JVxeFileCell.vue","sourceRoot":"src/components/JVxeCells","sourcesContent":["<template>\r\n  <div>\r\n    <template v-if=\"hasFile\" v-for=\"(file, fileKey) of [innerFile || {}]\">\r\n      <div :key=\"fileKey\" style=\"position: relative;\">\r\n        <a-tooltip v-if=\"file.status==='uploading'\" :title=\"`上传中(${Math.floor(file.percent)}%)`\">\r\n          <a-icon type=\"loading\"/>\r\n          <span style=\"margin-left:5px\">上传中…</span>\r\n        </a-tooltip>\r\n\r\n        <a-tooltip v-else-if=\"file.status==='done'\" :title=\"file.name\">\r\n          <a-icon type=\"paper-clip\"/>\r\n          <span style=\"margin-left:5px\">{{ ellipsisFileName }}</span>\r\n        </a-tooltip>\r\n\r\n        <a-tooltip v-else :title=\"file.name\">\r\n          <a-icon type=\"paper-clip\" style=\"color:red;\"/>\r\n          <span style=\"color:red;margin-left:5px\">{{ ellipsisFileName }}</span>\r\n        </a-tooltip>\r\n\r\n        <template style=\"width: 30px\">\r\n          <a-dropdown :trigger=\"['click']\" placement=\"bottomRight\" style=\"margin-left: 10px;\">\r\n            <a-tooltip title=\"操作\">\r\n              <a-icon\r\n                v-if=\"file.status!=='uploading'\"\r\n                type=\"setting\"\r\n                style=\"cursor: pointer;\"/>\r\n            </a-tooltip>\r\n\r\n            <a-menu slot=\"overlay\">\r\n              <a-menu-item v-if=\"originColumn.allowDownload !== false\" @click=\"handleClickDownloadFile\">\r\n                <span><a-icon type=\"download\"/>&nbsp;下载</span>\r\n              </a-menu-item>\r\n              <a-menu-item v-if=\"originColumn.allowRemove !== false\" @click=\"handleClickDeleteFile\">\r\n                <span><a-icon type=\"delete\"/>&nbsp;删除</span>\r\n              </a-menu-item>\r\n              <a-menu-item @click=\"handleMoreOperation(originColumn)\">\r\n                <span><a-icon type=\"bars\"/> 更多</span>\r\n              </a-menu-item>\r\n            </a-menu>\r\n          </a-dropdown>\r\n        </template>\r\n      </div>\r\n    </template>\r\n\r\n    <a-upload\r\n      v-show=\"!hasFile\"\r\n      name=\"file\"\r\n      :data=\"{'isup': 1}\"\r\n      :multiple=\"false\"\r\n      :action=\"uploadAction\"\r\n      :headers=\"uploadHeaders\"\r\n      :showUploadList=\"false\"\r\n      v-bind=\"cellProps\"\r\n      @change=\"handleChangeUpload\"\r\n    >\r\n      <a-button icon=\"upload\">{{originColumn.btnText || '上传文件'}}</a-button>\r\n    </a-upload>\r\n    <j-file-pop ref=\"filePop\" @ok=\"handleFileSuccess\" :number=\"number\"/>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import { getFileAccessHttpUrl } from '@api/manage'\r\n  import JVxeCellMixins from '@/components/jeecg/JVxeTable/mixins/JVxeCellMixins'\r\n  import { ACCESS_TOKEN } from '@/store/mutation-types'\r\n  import JFilePop from '@/components/jeecg/minipop/JFilePop'\r\n\r\n  import JVxeUploadCell from '@/components/jeecg/JVxeTable/components/cells/JVxeUploadCell'\r\n\r\n  export default {\r\n    name: 'JVxeFileCell',\r\n    mixins: [JVxeCellMixins],\r\n    components: {JFilePop},\r\n    props: {},\r\n    data() {\r\n      return {\r\n        innerFile: null,\r\n        number:0,\r\n      }\r\n    },\r\n    computed: {\r\n      /** upload headers */\r\n      uploadHeaders() {\r\n        let {originColumn: col} = this\r\n        let headers = {}\r\n        if (col.token === true) {\r\n          headers['X-Access-Token'] = this.$ls.get(ACCESS_TOKEN)\r\n        }\r\n        return headers\r\n      },\r\n\r\n      /** 上传请求地址 */\r\n      uploadAction() {\r\n        if (!this.originColumn.action) {\r\n          return window._CONFIG['domianURL'] + '/sys/common/upload'\r\n        } else {\r\n          return this.originColumn.action\r\n        }\r\n      },\r\n\r\n      hasFile() {\r\n        return this.innerFile != null\r\n      },\r\n\r\n      ellipsisFileName() {\r\n        let length = 5\r\n        let file = this.innerFile\r\n        if (!file || !file.name) {\r\n          return ''\r\n        }\r\n        if (file.name.length > length) {\r\n          return file.name.substr(0, length) + '…'\r\n        }\r\n        return file.name\r\n      },\r\n\r\n      responseName() {\r\n        if (this.originColumn.responseName) {\r\n          return this.originColumn.responseName\r\n        } else {\r\n          return 'message'\r\n        }\r\n      },\r\n\r\n    },\r\n    watch: {\r\n      innerValue: {\r\n        immediate: true,\r\n        handler() {\r\n          if (this.innerValue) {\r\n            this.innerFile = this.innerValue\r\n          } else {\r\n            this.innerFile = null\r\n          }\r\n        },\r\n      },\r\n    },\r\n    methods: {\r\n\r\n      // 点击更多按钮\r\n      handleMoreOperation(originColumn) {\r\n        //update-begin-author:wangshuai date:20201021 for:LOWCOD-969 判断传过来的字段是否存在number，用于控制上传文件\r\n        if (originColumn.number) {\r\n          this.number = originColumn.number\r\n        } else {\r\n          this.number = 0\r\n        }\r\n        //update-end-author:wangshuai date:20201021 for:LOWCOD-969 判断传过来的字段是否存在number，用于控制上传文件\r\n        if(originColumn && originColumn.fieldExtendJson){\r\n          let json = JSON.parse(originColumn.fieldExtendJson);\r\n          this.number = json.uploadnum?json.uploadnum:0;\r\n        }\r\n        let path = ''\r\n        if (this.innerFile) {\r\n          path = this.innerFile.path\r\n        }\r\n        this.$refs.filePop.show('', path)\r\n      },\r\n\r\n      // 更多上传回调\r\n      handleFileSuccess(file) {\r\n        if (file) {\r\n          this.innerFile.path = file.path\r\n          this.handleChangeCommon(this.innerFile)\r\n        }\r\n      },\r\n\r\n      handleChangeUpload(info) {\r\n        let {originColumn: col} = this\r\n        let {file} = info\r\n        let value = {\r\n          name: file.name,\r\n          type: file.type,\r\n          size: file.size,\r\n          status: file.status,\r\n          percent: file.percent\r\n        }\r\n        if (file.response) {\r\n          value['responseName'] = file.response[this.responseName]\r\n        }\r\n        if (file.status === 'done') {\r\n          value['path'] = file.response[this.responseName]\r\n          this.handleChangeCommon(value)\r\n        } else if (file.status === 'error') {\r\n          value['message'] = file.response.message || '未知错误'\r\n        }\r\n        this.innerFile = value\r\n      },\r\n\r\n      handleClickDownloadFile() {\r\n        let {url, path} = this.innerFile || {}\r\n        if (!url || url.length === 0) {\r\n          if (path && path.length > 0) {\r\n            url = getFileAccessHttpUrl(path.split(',')[0])\r\n          }\r\n        }\r\n        if (url) {\r\n          window.open(url)\r\n        }\r\n      },\r\n\r\n      handleClickDeleteFile() {\r\n        this.handleChangeCommon(null)\r\n      },\r\n\r\n    },\r\n    // 【组件增强】注释详见：JVxeCellMixins.js\r\n    enhanced: {\r\n      switches: {visible: true},\r\n      getValue: value => JVxeUploadCell.enhanced.getValue(value),\r\n      setValue: value => JVxeUploadCell.enhanced.setValue(value),\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n</style>\r\n"]}]}