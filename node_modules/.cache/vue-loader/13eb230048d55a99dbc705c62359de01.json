{"remainingRequest":"D:\\vue\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\vue\\src\\views\\user\\LoginSelectTenant.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\vue\\src\\views\\user\\LoginSelectTenant.vue","mtime":1615948822554},{"path":"D:\\vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1615952641464},{"path":"D:\\vue\\node_modules\\babel-loader\\lib\\index.js","mtime":1615952610415},{"path":"D:\\vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1615952641464},{"path":"D:\\vue\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader\\lib\\index.js","mtime":1615952643260}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCgppbXBvcnQgVnVlIGZyb20gJ3Z1ZScKaW1wb3J0IHsgZ2V0QWN0aW9uLHB1dEFjdGlvbiB9IGZyb20gJ0AvYXBpL21hbmFnZScKaW1wb3J0IHsgVVNFUl9JTkZPIH0gZnJvbSAiQC9zdG9yZS9tdXRhdGlvbi10eXBlcyIKaW1wb3J0IHN0b3JlIGZyb20gJy4vTG9naW4nCgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ0xvZ2luU2VsZWN0VGVuYW50JywKICBkYXRhKCl7CiAgICByZXR1cm4gewogICAgICB2aXNpYmxlOiBmYWxzZSwKICAgICAgaXNNdWx0aURlcGFydDpmYWxzZSwKICAgICAgZGVwYXJ0TGlzdDpbXSwKCiAgICAgIGlzTXVsdGlUZW5hbnQ6ZmFsc2UsCiAgICAgIHRlbmFudExpc3Q6W10sCgogICAgICB1c2VybmFtZTonJywKICAgICAgb3JnQ29kZTonJywKICAgICAgdGVuYW50X2lkOicnLAoKICAgICAgdmFsaWRhdGVfc3RhdHVzMTogIiIsCiAgICAgIHZhbGlkYXRlX3N0YXR1czI6ICIiLAogICAgfQogIH0sCiAgY29tcHV0ZWQ6ewogICAgdGl0bGUoKXsKICAgICAgaWYodGhpcy5pc011bHRpRGVwYXJ0ICYmIHRoaXMuaXNNdWx0aVRlbmFudCl7CiAgICAgICAgcmV0dXJuICfor7fpgInmi6nnp5/miLflkozpg6jpl6gnCiAgICAgIH1lbHNlIGlmKHRoaXMuaXNNdWx0aURlcGFydCAmJiAhdGhpcy5pc011bHRpVGVuYW50KXsKICAgICAgICByZXR1cm4gJ+ivt+mAieaLqemDqOmXqCcKICAgICAgfWVsc2UgaWYoIXRoaXMuaXNNdWx0aURlcGFydCAmJiB0aGlzLmlzTXVsdGlUZW5hbnQpewogICAgICAgIHJldHVybiAn6K+36YCJ5oup56ef5oi3JwogICAgICB9CiAgICB9CiAgfSwKICBtZXRob2RzOnsKICAgIGNsZWFyKCl7CiAgICAgIHRoaXMuZGVwYXJ0TGlzdCA9IFtdCiAgICAgIHRoaXMudGVuYW50TGlzdCA9IFtdCiAgICAgIHRoaXMudmlzaWJsZT1mYWxzZQogICAgICB0aGlzLnZhbGlkYXRlX3N0YXR1czE9JycKICAgICAgdGhpcy52YWxpZGF0ZV9zdGF0dXMyPScnCiAgICB9LAogICAgYml6RGVwYXJ0KGxvZ2luUmVzdWx0KXsKICAgICAgbGV0IG11bHRpX2RlcGFydCA9IGxvZ2luUmVzdWx0Lm11bHRpX2RlcGFydAogICAgICAvLzA65peg6YOo6ZeoIDE65LiA5Liq6YOo6ZeoIDI65aSa5Liq6YOo6ZeoCiAgICAgIGlmKG11bHRpX2RlcGFydD09MCl7CiAgICAgICAgdGhpcy4kbm90aWZpY2F0aW9uLndhcm4oewogICAgICAgICAgbWVzc2FnZTogJ+aPkOekuicsCiAgICAgICAgICBkZXNjcmlwdGlvbjogYOaCqOWwmuacquW9kuWxnumDqOmXqCzor7fnoa7orqTotKblj7fkv6Hmga9gLAogICAgICAgICAgZHVyYXRpb246MwogICAgICAgIH0pOwogICAgICAgIHRoaXMuaXNNdWx0aURlcGFydCA9IGZhbHNlCiAgICAgIH1lbHNlIGlmKG11bHRpX2RlcGFydD09Mil7CiAgICAgICAgdGhpcy52aXNpYmxlPXRydWUKICAgICAgICB0aGlzLmlzTXVsdGlEZXBhcnQgPSB0cnVlCiAgICAgICAgdGhpcy5kZXBhcnRMaXN0ID0gbG9naW5SZXN1bHQuZGVwYXJ0cwogICAgICB9ZWxzZSB7CiAgICAgICAgdGhpcy5pc011bHRpRGVwYXJ0ID0gZmFsc2UKICAgICAgfQogICAgfSwKICAgIGJpelRlbmFudChpZHMpewogICAgICBpZighaWRzIHx8IGlkcy5sZW5ndGg9PTApewogICAgICAgIHRoaXMuaXNNdWx0aVRlbmFudCA9IGZhbHNlCiAgICAgIH0gZWxzZSBpZihpZHMuaW5kZXhPZignLCcpPDApewogICAgICAgIHRoaXMudGVuYW50X2lkID0gaWRzOwogICAgICAgIHRoaXMuaXNNdWx0aVRlbmFudCA9IGZhbHNlCiAgICAgIH1lbHNlewogICAgICAgIHRoaXMudmlzaWJsZSA9IHRydWUKICAgICAgICB0aGlzLmlzTXVsdGlUZW5hbnQgPSB0cnVlCiAgICAgICAgZ2V0QWN0aW9uKCcvc3lzL3RlbmFudC9xdWVyeUxpc3QnLCB7aWRzOiBpZHN9KS50aGVuKHJlcz0+ewogICAgICAgICAgdGhpcy50ZW5hbnRMaXN0ID0gcmVzLnJlc3VsdAogICAgICAgIH0pCiAgICAgIH0KICAgIH0sCiAgICBzaG93KGxvZ2luUmVzdWx0KXsKICAgICAgdGhpcy5jbGVhcigpOwogICAgICB0aGlzLmJpekRlcGFydChsb2dpblJlc3VsdCk7CgogICAgICBsZXQgdXNlciA9IFZ1ZS5scy5nZXQoVVNFUl9JTkZPKQogICAgICB0aGlzLnVzZXJuYW1lID0gdXNlci51c2VybmFtZQogICAgICBsZXQgaWRzID0gdXNlci5yZWxUZW5hbnRJZHMKICAgICAgdGhpcy5iaXpUZW5hbnQoaWRzKTsKCiAgICAgIGlmKHRoaXMudmlzaWJsZT09PWZhbHNlKXsKICAgICAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnc2F2ZVRlbmFudCcsIHRoaXMudGVuYW50X2lkKTsKICAgICAgICB0aGlzLiRlbWl0KCdzdWNjZXNzJykKICAgICAgfQoKICAgIH0sCiAgICByZXF1ZXN0RmFpbGVkIChlcnIpIHsKICAgICAgdGhpcy4kbm90aWZpY2F0aW9uWyAnZXJyb3InIF0oewogICAgICAgIG1lc3NhZ2U6ICfnmbvlvZXlpLHotKUnLAogICAgICAgIGRlc2NyaXB0aW9uOiAoKGVyci5yZXNwb25zZSB8fCB7fSkuZGF0YSB8fCB7fSkubWVzc2FnZSB8fCBlcnIubWVzc2FnZSB8fCAi6K+35rGC5Ye6546w6ZSZ6K+v77yM6K+356iN5ZCO5YaN6K+VIiwKICAgICAgICBkdXJhdGlvbjogNCwKICAgICAgfSk7CiAgICAgIHRoaXMubG9naW5CdG4gPSBmYWxzZTsKICAgIH0sCiAgICBkZXBhcnRSZXNvbHZlKCl7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KT0+ewogICAgICAgIGlmKHRoaXMuaXNNdWx0aURlcGFydD09PWZhbHNlKXsKICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICB9ZWxzZXsKICAgICAgICAgIGxldCBvYmogPSB7CiAgICAgICAgICAgIG9yZ0NvZGU6dGhpcy5vcmdDb2RlLAogICAgICAgICAgICB1c2VybmFtZTp0aGlzLnVzZXJuYW1lCiAgICAgICAgICB9CiAgICAgICAgICBwdXRBY3Rpb24oIi9zeXMvc2VsZWN0RGVwYXJ0IixvYmopLnRoZW4ocmVzPT57CiAgICAgICAgICAgIGlmKHJlcy5zdWNjZXNzKXsKICAgICAgICAgICAgICBjb25zdCB1c2VySW5mbyA9IHJlcy5yZXN1bHQudXNlckluZm87CiAgICAgICAgICAgICAgVnVlLmxzLnNldChVU0VSX0lORk8sIHVzZXJJbmZvLCA3ICogMjQgKiA2MCAqIDYwICogMTAwMCk7CiAgICAgICAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdTRVRfSU5GTycsIHVzZXJJbmZvKTsKICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCItLS3liIfmjaLnu4Tnu4fmnLrmnoQtLS11c2VySW5mby0tLS0tLS0iLHN0b3JlLmdldHRlcnMudXNlckluZm8ub3JnQ29kZSk7CiAgICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICB0aGlzLnJlcXVlc3RGYWlsZWQocmVzKQogICAgICAgICAgICAgIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdMb2dvdXQnKTsKICAgICAgICAgICAgICByZWplY3QoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkKICAgICAgICB9CiAgICAgIH0pCiAgICB9LAogICAgc2VsZWN0T2soKXsKICAgICAgaWYodGhpcy5pc011bHRpVGVuYW50ICYmICF0aGlzLnRlbmFudF9pZCl7CiAgICAgICAgdGhpcy52YWxpZGF0ZV9zdGF0dXMxPSdlcnJvcicKICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgfQogICAgICBpZih0aGlzLmlzTXVsdGlEZXBhcnQgJiYgIXRoaXMub3JnQ29kZSl7CiAgICAgICAgdGhpcy52YWxpZGF0ZV9zdGF0dXMyPSdlcnJvcicKICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgfQogICAgICB0aGlzLmRlcGFydFJlc29sdmUoKS50aGVuKCgpPT57CiAgICAgICAgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ3NhdmVUZW5hbnQnLCB0aGlzLnRlbmFudF9pZCk7CiAgICAgICAgaWYodGhpcy5pc011bHRpVGVuYW50KXsKICAgICAgICAgIHRoaXMuJGVtaXQoJ3N1Y2Nlc3MnKQogICAgICAgIH1lbHNlewogICAgICAgICAgdGhpcy4kZW1pdCgnc3VjY2VzcycpCiAgICAgICAgfQogICAgICB9KS5jYXRjaCgoKT0+ewogICAgICAgIGNvbnNvbGUubG9nKCfnmbvlvZXpgInmi6nlh7rpl67popgnKQogICAgICB9KQogICAgfSwKICAgIGhhbmRsZVRlbmFudENoYW5nZShlKXsKICAgICAgdGhpcy52YWxpZGF0ZV9zdGF0dXMxID0gJycKICAgICAgdGhpcy50ZW5hbnRfaWQgPSBlCiAgICB9LAogICAgaGFuZGxlRGVwYXJ0Q2hhbmdlKGUpewogICAgICB0aGlzLnZhbGlkYXRlX3N0YXR1czIgPSAnJwogICAgICB0aGlzLm9yZ0NvZGUgPSBlCiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["LoginSelectTenant.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoDA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"LoginSelectTenant.vue","sourceRoot":"src/views/user","sourcesContent":["<template>\r\n  <a-modal\r\n    :title=\"title\"\r\n    :width=\"450\"\r\n    :visible=\"visible\"\r\n    :closable=\"false\"\r\n    :maskClosable=\"false\">\r\n\r\n    <template slot=\"footer\">\r\n      <a-button type=\"primary\" @click=\"selectOk\">确认</a-button>\r\n    </template>\r\n\r\n    <a-form>\r\n      <a-form-item v-if=\"isMultiTenant\" :labelCol=\"{span:4}\" :wrapperCol=\"{span:20}\" style=\"margin-bottom:10px\" :validate-status=\"validate_status1\">\r\n        <a-tooltip placement=\"topLeft\" >\r\n          <template slot=\"title\">\r\n            <span>您有多个租户，请选择登录租户</span>\r\n          </template>\r\n        <a-avatar style=\"backgroundColor:#87d068\" icon=\"gold\" />\r\n        </a-tooltip>\r\n\r\n        <a-select @change=\"handleTenantChange\" :class=\"{'valid-error':validate_status1=='error'}\" placeholder=\"请选择登录租户\" style=\"margin-left:10px;width: 80%\">\r\n          <a-icon slot=\"suffixIcon\" type=\"gold\" />\r\n          <a-select-option v-for=\"d in tenantList\" :key=\"d.id\" :value=\"d.id\">\r\n            {{ d.name }}\r\n          </a-select-option>\r\n        </a-select>\r\n      </a-form-item>\r\n\r\n\r\n      <a-form-item v-if=\"isMultiDepart\" :labelCol=\"{span:4}\" :wrapperCol=\"{span:20}\" style=\"margin-bottom:10px\" :validate-status=\"validate_status2\">\r\n        <a-tooltip placement=\"topLeft\" >\r\n          <template slot=\"title\">\r\n            <span>您有多个部门，请选择登录部门</span>\r\n          </template>\r\n          <a-avatar style=\"backgroundColor:rgb(104, 208, 203);\" icon=\"gold\" />\r\n        </a-tooltip>\r\n\r\n        <a-select @change=\"handleDepartChange\" :class=\"{'valid-error':validate_status2=='error'}\" placeholder=\"请选择登录部门\" style=\"margin-left:10px;width: 80%\">\r\n          <a-icon slot=\"suffixIcon\" type=\"gold\" />\r\n          <a-select-option v-for=\"d in departList\" :key=\"d.id\" :value=\"d.orgCode\">\r\n            {{ d.departName }}\r\n          </a-select-option>\r\n        </a-select>\r\n      </a-form-item>\r\n\r\n    </a-form>\r\n  </a-modal>\r\n</template>\r\n\r\n<script>\r\n\r\n  import Vue from 'vue'\r\n  import { getAction,putAction } from '@/api/manage'\r\n  import { USER_INFO } from \"@/store/mutation-types\"\r\n  import store from './Login'\r\n\r\n  export default {\r\n    name: 'LoginSelectTenant',\r\n    data(){\r\n      return {\r\n        visible: false,\r\n        isMultiDepart:false,\r\n        departList:[],\r\n\r\n        isMultiTenant:false,\r\n        tenantList:[],\r\n\r\n        username:'',\r\n        orgCode:'',\r\n        tenant_id:'',\r\n\r\n        validate_status1: \"\",\r\n        validate_status2: \"\",\r\n      }\r\n    },\r\n    computed:{\r\n      title(){\r\n        if(this.isMultiDepart && this.isMultiTenant){\r\n          return '请选择租户和部门'\r\n        }else if(this.isMultiDepart && !this.isMultiTenant){\r\n          return '请选择部门'\r\n        }else if(!this.isMultiDepart && this.isMultiTenant){\r\n          return '请选择租户'\r\n        }\r\n      }\r\n    },\r\n    methods:{\r\n      clear(){\r\n        this.departList = []\r\n        this.tenantList = []\r\n        this.visible=false\r\n        this.validate_status1=''\r\n        this.validate_status2=''\r\n      },\r\n      bizDepart(loginResult){\r\n        let multi_depart = loginResult.multi_depart\r\n        //0:无部门 1:一个部门 2:多个部门\r\n        if(multi_depart==0){\r\n          this.$notification.warn({\r\n            message: '提示',\r\n            description: `您尚未归属部门,请确认账号信息`,\r\n            duration:3\r\n          });\r\n          this.isMultiDepart = false\r\n        }else if(multi_depart==2){\r\n          this.visible=true\r\n          this.isMultiDepart = true\r\n          this.departList = loginResult.departs\r\n        }else {\r\n          this.isMultiDepart = false\r\n        }\r\n      },\r\n      bizTenant(ids){\r\n        if(!ids || ids.length==0){\r\n          this.isMultiTenant = false\r\n        } else if(ids.indexOf(',')<0){\r\n          this.tenant_id = ids;\r\n          this.isMultiTenant = false\r\n        }else{\r\n          this.visible = true\r\n          this.isMultiTenant = true\r\n          getAction('/sys/tenant/queryList', {ids: ids}).then(res=>{\r\n            this.tenantList = res.result\r\n          })\r\n        }\r\n      },\r\n      show(loginResult){\r\n        this.clear();\r\n        this.bizDepart(loginResult);\r\n\r\n        let user = Vue.ls.get(USER_INFO)\r\n        this.username = user.username\r\n        let ids = user.relTenantIds\r\n        this.bizTenant(ids);\r\n\r\n        if(this.visible===false){\r\n          this.$store.dispatch('saveTenant', this.tenant_id);\r\n          this.$emit('success')\r\n        }\r\n\r\n      },\r\n      requestFailed (err) {\r\n        this.$notification[ 'error' ]({\r\n          message: '登录失败',\r\n          description: ((err.response || {}).data || {}).message || err.message || \"请求出现错误，请稍后再试\",\r\n          duration: 4,\r\n        });\r\n        this.loginBtn = false;\r\n      },\r\n      departResolve(){\r\n        return new Promise((resolve, reject)=>{\r\n          if(this.isMultiDepart===false){\r\n            resolve();\r\n          }else{\r\n            let obj = {\r\n              orgCode:this.orgCode,\r\n              username:this.username\r\n            }\r\n            putAction(\"/sys/selectDepart\",obj).then(res=>{\r\n              if(res.success){\r\n                const userInfo = res.result.userInfo;\r\n                Vue.ls.set(USER_INFO, userInfo, 7 * 24 * 60 * 60 * 1000);\r\n                this.$store.commit('SET_INFO', userInfo);\r\n                //console.log(\"---切换组织机构---userInfo-------\",store.getters.userInfo.orgCode);\r\n                resolve();\r\n              }else{\r\n                this.requestFailed(res)\r\n                this.$store.dispatch('Logout');\r\n                reject();\r\n              }\r\n            })\r\n          }\r\n        })\r\n      },\r\n      selectOk(){\r\n        if(this.isMultiTenant && !this.tenant_id){\r\n          this.validate_status1='error'\r\n          return false\r\n        }\r\n        if(this.isMultiDepart && !this.orgCode){\r\n          this.validate_status2='error'\r\n          return false\r\n        }\r\n        this.departResolve().then(()=>{\r\n          this.$store.dispatch('saveTenant', this.tenant_id);\r\n          if(this.isMultiTenant){\r\n            this.$emit('success')\r\n          }else{\r\n            this.$emit('success')\r\n          }\r\n        }).catch(()=>{\r\n          console.log('登录选择出问题')\r\n        })\r\n      },\r\n      handleTenantChange(e){\r\n        this.validate_status1 = ''\r\n        this.tenant_id = e\r\n      },\r\n      handleDepartChange(e){\r\n        this.validate_status2 = ''\r\n        this.orgCode = e\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped>\r\n\r\n</style>"]}]}