{"remainingRequest":"D:\\vue\\node_modules\\babel-loader\\lib\\index.js!D:\\vue\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\vue\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\vue\\src\\components\\jeecg\\JVxeTable\\components\\cells\\JVxeUploadCell.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\vue\\src\\components\\jeecg\\JVxeTable\\components\\cells\\JVxeUploadCell.vue","mtime":1615948814733},{"path":"D:\\vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1615952641464},{"path":"D:\\vue\\node_modules\\babel-loader\\lib\\index.js","mtime":1615952610415},{"path":"D:\\vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1615952641464},{"path":"D:\\vue\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader\\lib\\index.js","mtime":1615952643260}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IEpWeGVDZWxsTWl4aW5zIGZyb20gJ0AvY29tcG9uZW50cy9qZWVjZy9KVnhlVGFibGUvbWl4aW5zL0pWeGVDZWxsTWl4aW5zJzsKaW1wb3J0IHsgQUNDRVNTX1RPS0VOIH0gZnJvbSAnQC9zdG9yZS9tdXRhdGlvbi10eXBlcyc7CmltcG9ydCB7IGdldEZpbGVBY2Nlc3NIdHRwVXJsIH0gZnJvbSAnQGFwaS9tYW5hZ2UnOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ0pWeGVVcGxvYWRDZWxsJywKICBtaXhpbnM6IFtKVnhlQ2VsbE1peGluc10sCiAgcHJvcHM6IHt9LAogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBpbm5lckZpbGU6IG51bGwKICAgIH07CiAgfSwKICBjb21wdXRlZDogewogICAgLyoqIHVwbG9hZCBoZWFkZXJzICovCiAgICB1cGxvYWRIZWFkZXJzOiBmdW5jdGlvbiB1cGxvYWRIZWFkZXJzKCkgewogICAgICB2YXIgY29sID0gdGhpcy5vcmlnaW5Db2x1bW47CiAgICAgIHZhciBoZWFkZXJzID0ge307CgogICAgICBpZiAoY29sLnRva2VuID09PSB0cnVlKSB7CiAgICAgICAgaGVhZGVyc1snWC1BY2Nlc3MtVG9rZW4nXSA9IHRoaXMuJGxzLmdldChBQ0NFU1NfVE9LRU4pOwogICAgICB9CgogICAgICByZXR1cm4gaGVhZGVyczsKICAgIH0sCiAgICBoYXNGaWxlOiBmdW5jdGlvbiBoYXNGaWxlKCkgewogICAgICByZXR1cm4gdGhpcy5pbm5lckZpbGUgIT0gbnVsbDsKICAgIH0KICB9LAogIHdhdGNoOiB7CiAgICBpbm5lclZhbHVlOiB7CiAgICAgIGltbWVkaWF0ZTogdHJ1ZSwKICAgICAgaGFuZGxlcjogZnVuY3Rpb24gaGFuZGxlcigpIHsKICAgICAgICBpZiAodGhpcy5pbm5lclZhbHVlKSB7CiAgICAgICAgICB0aGlzLmlubmVyRmlsZSA9IHRoaXMuaW5uZXJWYWx1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5pbm5lckZpbGUgPSBudWxsOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgaGFuZGxlQ2hhbmdlVXBsb2FkOiBmdW5jdGlvbiBoYW5kbGVDaGFuZ2VVcGxvYWQoaW5mbykgewogICAgICB2YXIgcm93ID0gdGhpcy5yb3csCiAgICAgICAgICBjb2wgPSB0aGlzLm9yaWdpbkNvbHVtbjsKICAgICAgdmFyIGZpbGUgPSBpbmZvLmZpbGU7CiAgICAgIHZhciB2YWx1ZSA9IHsKICAgICAgICBuYW1lOiBmaWxlLm5hbWUsCiAgICAgICAgdHlwZTogZmlsZS50eXBlLAogICAgICAgIHNpemU6IGZpbGUuc2l6ZSwKICAgICAgICBzdGF0dXM6IGZpbGUuc3RhdHVzLAogICAgICAgIHBlcmNlbnQ6IGZpbGUucGVyY2VudAogICAgICB9OwoKICAgICAgaWYgKGNvbC5yZXNwb25zZU5hbWUgJiYgZmlsZS5yZXNwb25zZSkgewogICAgICAgIHZhbHVlWydyZXNwb25zZU5hbWUnXSA9IGZpbGUucmVzcG9uc2VbY29sLnJlc3BvbnNlTmFtZV07CiAgICAgIH0KCiAgICAgIGlmIChmaWxlLnN0YXR1cyA9PT0gJ2RvbmUnKSB7CiAgICAgICAgdmFsdWVbJ3BhdGgnXSA9IGZpbGUucmVzcG9uc2VbY29sLnJlc3BvbnNlTmFtZV07CiAgICAgICAgdGhpcy5oYW5kbGVDaGFuZ2VDb21tb24odmFsdWUpOwogICAgICB9IGVsc2UgaWYgKGZpbGUuc3RhdHVzID09PSAnZXJyb3InKSB7CiAgICAgICAgdmFsdWVbJ21lc3NhZ2UnXSA9IGZpbGUucmVzcG9uc2UubWVzc2FnZSB8fCAn5pyq55+l6ZSZ6K+vJzsKICAgICAgfQoKICAgICAgdGhpcy5pbm5lckZpbGUgPSB2YWx1ZTsKICAgIH0sCiAgICAvLyBoYW5kbGVDbGlja1ByZXZpZXdGaWxlKGlkKSB7CiAgICAvLyAgIHRoaXMuJG1lc3NhZ2UuaW5mbygn5bCa5pyq5a6e546wJykKICAgIC8vIH0sCiAgICBoYW5kbGVDbGlja0Rvd25sb2FkRmlsZTogZnVuY3Rpb24gaGFuZGxlQ2xpY2tEb3dubG9hZEZpbGUoaWQpIHsKICAgICAgdmFyIF9yZWYgPSB0aGlzLnZhbHVlIHx8IHt9LAogICAgICAgICAgcGF0aCA9IF9yZWYucGF0aDsKCiAgICAgIGlmIChwYXRoKSB7CiAgICAgICAgdmFyIHVybCA9IGdldEZpbGVBY2Nlc3NIdHRwVXJsKHBhdGgpOwogICAgICAgIHdpbmRvdy5vcGVuKHVybCk7CiAgICAgIH0KICAgIH0sCiAgICBoYW5kbGVDbGlja0RlbGV0ZUZpbGU6IGZ1bmN0aW9uIGhhbmRsZUNsaWNrRGVsZXRlRmlsZSgpIHsKICAgICAgdGhpcy5oYW5kbGVDaGFuZ2VDb21tb24obnVsbCk7CiAgICB9CiAgfSwKICAvLyDjgJDnu4Tku7blop7lvLrjgJHms6jph4ror6bop4HvvJpKVnhlQ2VsbE1peGlucy5qcwogIGVuaGFuY2VkOiB7CiAgICBzd2l0Y2hlczogewogICAgICB2aXNpYmxlOiB0cnVlCiAgICB9LAogICAgZ2V0VmFsdWU6IGZ1bmN0aW9uIGdldFZhbHVlKHZhbHVlKSB7CiAgICAgIHJldHVybiBmaWxlR2V0VmFsdWUodmFsdWUpOwogICAgfSwKICAgIHNldFZhbHVlOiBmdW5jdGlvbiBzZXRWYWx1ZSh2YWx1ZSkgewogICAgICByZXR1cm4gZmlsZVNldFZhbHVlKHZhbHVlKTsKICAgIH0KICB9Cn07CgpmdW5jdGlvbiBmaWxlR2V0VmFsdWUodmFsdWUpIHsKICBpZiAodmFsdWUgJiYgdmFsdWUucGF0aCkgewogICAgcmV0dXJuIHZhbHVlLnBhdGg7CiAgfQoKICByZXR1cm4gdmFsdWU7Cn0KCmZ1bmN0aW9uIGZpbGVTZXRWYWx1ZSh2YWx1ZSkgewogIGlmICh2YWx1ZSkgewogICAgdmFyIGZpcnN0ID0gdmFsdWUuc3BsaXQoJywnKVswXTsKICAgIHZhciBuYW1lID0gZmlyc3Quc3Vic3RyaW5nKGZpcnN0Lmxhc3RJbmRleE9mKCcvJykgKyAxKTsKICAgIHJldHVybiB7CiAgICAgIG5hbWU6IG5hbWUsCiAgICAgIHBhdGg6IHZhbHVlLAogICAgICBzdGF0dXM6ICdkb25lJwogICAgfTsKICB9CgogIHJldHVybiB2YWx1ZTsKfQ=="},{"version":3,"sources":["JVxeUploadCell.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div>\r\n    <template v-if=\"hasFile\" v-for=\"(file, fileKey) of [innerFile || {}]\">\r\n      <a-input\r\n        :key=\"fileKey\"\r\n        :readOnly=\"true\"\r\n        :value=\"file.name\"\r\n      >\r\n\r\n        <template slot=\"addonBefore\" style=\"width: 30px\">\r\n          <a-tooltip v-if=\"file.status === 'uploading'\" :title=\"`上传中(${Math.floor(file.percent)}%)`\">\r\n            <a-icon type=\"loading\"/>\r\n          </a-tooltip>\r\n          <a-tooltip v-else-if=\"file.status === 'done'\" title=\"上传完成\">\r\n            <a-icon type=\"check-circle\" style=\"color:#00DB00;\"/>\r\n          </a-tooltip>\r\n          <a-tooltip v-else title=\"上传失败\">\r\n            <a-icon type=\"exclamation-circle\" style=\"color:red;\"/>\r\n          </a-tooltip>\r\n        </template>\r\n\r\n        <span v-if=\"file.status === 'uploading'\" slot=\"addonAfter\">{{ Math.floor(file.percent) }}%</span>\r\n        <template v-else-if=\"originColumn.allowDownload !== false || originColumn.allowRemove !== false\" slot=\"addonAfter\">\r\n          <a-dropdown :trigger=\"['click']\" placement=\"bottomRight\">\r\n            <a-tooltip title=\"操作\">\r\n              <a-icon\r\n                type=\"setting\"\r\n                style=\"cursor: pointer;\"/>\r\n            </a-tooltip>\r\n\r\n            <a-menu slot=\"overlay\">\r\n              <!-- <a-menu-item @click=\"handleClickPreviewFile\">-->\r\n              <!--  <span><a-icon type=\"eye\"/>&nbsp;预览</span>-->\r\n              <!-- </a-menu-item>-->\r\n              <a-menu-item v-if=\"originColumn.allowDownload !== false\" @click=\"handleClickDownloadFile\">\r\n                <span><a-icon type=\"download\"/>&nbsp;下载</span>\r\n              </a-menu-item>\r\n              <a-menu-item v-if=\"originColumn.allowRemove !== false\" @click=\"handleClickDeleteFile\">\r\n                <span><a-icon type=\"delete\"/>&nbsp;删除</span>\r\n              </a-menu-item>\r\n            </a-menu>\r\n          </a-dropdown>\r\n        </template>\r\n\r\n      </a-input>\r\n    </template>\r\n    <a-upload\r\n      v-show=\"!hasFile\"\r\n      name=\"file\"\r\n      :data=\"{'isup': 1}\"\r\n      :multiple=\"false\"\r\n      :action=\"originColumn.action\"\r\n      :headers=\"uploadHeaders\"\r\n      :showUploadList=\"false\"\r\n      v-bind=\"cellProps\"\r\n      @change=\"handleChangeUpload\"\r\n    >\r\n      <a-button icon=\"upload\">{{originColumn.btnText || '点击上传'}}</a-button>\r\n    </a-upload>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import JVxeCellMixins from '@/components/jeecg/JVxeTable/mixins/JVxeCellMixins'\r\n  import { ACCESS_TOKEN } from '@/store/mutation-types'\r\n  import { getFileAccessHttpUrl } from '@api/manage'\r\n\r\n  export default {\r\n    name: 'JVxeUploadCell',\r\n    mixins: [JVxeCellMixins],\r\n    props: {},\r\n    data() {\r\n      return {\r\n        innerFile: null,\r\n      }\r\n    },\r\n    computed: {\r\n      /** upload headers */\r\n      uploadHeaders() {\r\n        let {originColumn: col} = this\r\n        let headers = {}\r\n        if (col.token === true) {\r\n          headers['X-Access-Token'] = this.$ls.get(ACCESS_TOKEN)\r\n        }\r\n        return headers\r\n      },\r\n\r\n      hasFile() {\r\n        return this.innerFile != null\r\n      },\r\n\r\n    },\r\n    watch: {\r\n      innerValue: {\r\n        immediate: true,\r\n        handler() {\r\n          if (this.innerValue) {\r\n            this.innerFile = this.innerValue\r\n          } else {\r\n            this.innerFile = null\r\n          }\r\n        },\r\n      },\r\n    },\r\n    methods: {\r\n\r\n      handleChangeUpload(info) {\r\n        let {row, originColumn: col} = this\r\n        let {file} = info\r\n        let value = {\r\n          name: file.name,\r\n          type: file.type,\r\n          size: file.size,\r\n          status: file.status,\r\n          percent: file.percent\r\n        }\r\n        if (col.responseName && file.response) {\r\n          value['responseName'] = file.response[col.responseName]\r\n        }\r\n        if (file.status === 'done') {\r\n          value['path'] = file.response[col.responseName]\r\n          this.handleChangeCommon(value)\r\n        } else if (file.status === 'error') {\r\n          value['message'] = file.response.message || '未知错误'\r\n        }\r\n        this.innerFile = value\r\n      },\r\n\r\n      // handleClickPreviewFile(id) {\r\n      //   this.$message.info('尚未实现')\r\n      // },\r\n\r\n      handleClickDownloadFile(id) {\r\n        let {path} = this.value || {}\r\n        if (path) {\r\n          let url = getFileAccessHttpUrl(path)\r\n          window.open(url)\r\n        }\r\n      },\r\n\r\n      handleClickDeleteFile() {\r\n        this.handleChangeCommon(null)\r\n      },\r\n\r\n    },\r\n    // 【组件增强】注释详见：JVxeCellMixins.js\r\n    enhanced: {\r\n      switches: {visible: true},\r\n      getValue: value => fileGetValue(value),\r\n      setValue: value => fileSetValue(value),\r\n    }\r\n  }\r\n\r\n  function fileGetValue(value) {\r\n    if (value && value.path) {\r\n      return value.path\r\n    }\r\n    return value\r\n  }\r\n\r\n  function fileSetValue(value) {\r\n    if (value) {\r\n      let first = value.split(',')[0]\r\n      let name = first.substring(first.lastIndexOf('/') + 1)\r\n      return {\r\n        name: name,\r\n        path: value,\r\n        status: 'done',\r\n      }\r\n    }\r\n    return value\r\n  }\r\n\r\n</script>\r\n\r\n<style scoped>\r\n\r\n</style>"],"sourceRoot":"src/components/jeecg/JVxeTable/components/cells"}]}