{"remainingRequest":"D:\\vue\\node_modules\\babel-loader\\lib\\index.js!D:\\vue\\src\\cas\\sso.js","dependencies":[{"path":"D:\\vue\\src\\cas\\sso.js","mtime":1615948813361},{"path":"D:\\vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1615952641464},{"path":"D:\\vue\\node_modules\\babel-loader\\lib\\index.js","mtime":1615952610415}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IFZ1ZSBmcm9tICd2dWUnOwppbXBvcnQgeyBBQ0NFU1NfVE9LRU4gfSBmcm9tICJAL3N0b3JlL211dGF0aW9uLXR5cGVzIjsKaW1wb3J0IHN0b3JlIGZyb20gJ0Avc3RvcmUnOwovKioNCiAqIOWNleeCueeZu+W9lQ0KICovCgp2YXIgaW5pdCA9IGZ1bmN0aW9uIGluaXQoY2FsbGJhY2spIHsKICBpZiAocHJvY2Vzcy5lbnYuVlVFX0FQUF9TU08gPT0gJ3RydWUnKSB7CiAgICBjb25zb2xlLmxvZygiLS0tLS0tLeWNleeCueeZu+W9leW8gOWniy0tLS0tLS0iKTsKICAgIHZhciB0b2tlbiA9IFZ1ZS5scy5nZXQoQUNDRVNTX1RPS0VOKTsKICAgIHZhciBzdCA9IGdldFVybFBhcmFtKCJ0aWNrZXQiKTsKICAgIHZhciBzZXZpY2UgPSAiaHR0cDovLyIgKyB3aW5kb3cubG9jYXRpb24uaG9zdCArICIvIjsKCiAgICBpZiAodG9rZW4pIHsKICAgICAgbG9naW5TdWNjZXNzKGNhbGxiYWNrKTsKICAgIH0gZWxzZSB7CiAgICAgIGlmIChzdCkgewogICAgICAgIHZhbGlkYXRlU3Qoc3QsIHNldmljZSwgY2FsbGJhY2spOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW5jb2RlVVJJQ29tcG9uZW50KHNldmljZSk7CiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSB3aW5kb3cuX0NPTkZJR1snY2FzUHJlZml4VXJsJ10gKyAiL2xvZ2luP3NlcnZpY2U9IiArIHNlcnZpY2VVcmw7CiAgICAgIH0KICAgIH0KCiAgICBjb25zb2xlLmxvZygiLS0tLS0tLeWNleeCueeZu+W9lee7k+adny0tLS0tLS0iKTsKICB9IGVsc2UgewogICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soKTsKICB9Cn07Cgp2YXIgU1NPID0gewogIGluaXQ6IGluaXQKfTsKCmZ1bmN0aW9uIGdldFVybFBhcmFtKHBhcmFOYW1lKSB7CiAgdmFyIHVybCA9IGRvY3VtZW50LmxvY2F0aW9uLnRvU3RyaW5nKCk7CiAgdmFyIGFyck9iaiA9IHVybC5zcGxpdCgiPyIpOwoKICBpZiAoYXJyT2JqLmxlbmd0aCA+IDEpIHsKICAgIHZhciBhcnJQYXJhID0gYXJyT2JqWzFdLnNwbGl0KCImIik7CiAgICB2YXIgYXJyOwoKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyUGFyYS5sZW5ndGg7IGkrKykgewogICAgICBhcnIgPSBhcnJQYXJhW2ldLnNwbGl0KCI9Iik7CgogICAgICBpZiAoYXJyICE9IG51bGwgJiYgYXJyWzBdID09IHBhcmFOYW1lKSB7CiAgICAgICAgcmV0dXJuIGFyclsxXTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiAiIjsKICB9IGVsc2UgewogICAgcmV0dXJuICIiOwogIH0KfQoKZnVuY3Rpb24gdmFsaWRhdGVTdCh0aWNrZXQsIHNlcnZpY2UsIGNhbGxiYWNrKSB7CiAgdmFyIHBhcmFtcyA9IHsKICAgIHRpY2tldDogdGlja2V0LAogICAgc2VydmljZTogc2VydmljZQogIH07CiAgc3RvcmUuZGlzcGF0Y2goJ1ZhbGlkYXRlTG9naW4nLCBwYXJhbXMpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgLy90aGlzLmRlcGFydENvbmZpcm0ocmVzKQogICAgaWYgKHJlcy5zdWNjZXNzKSB7CiAgICAgIGxvZ2luU3VjY2VzcyhjYWxsYmFjayk7CiAgICB9IGVsc2UgewogICAgICB2YXIgc2V2aWNlID0gImh0dHA6Ly8iICsgd2luZG93LmxvY2F0aW9uLmhvc3QgKyAiLyI7CiAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW5jb2RlVVJJQ29tcG9uZW50KHNldmljZSk7CiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gd2luZG93Ll9DT05GSUdbJ2Nhc1ByZWZpeFVybCddICsgIi9sb2dpbj9zZXJ2aWNlPSIgKyBzZXJ2aWNlVXJsOwogICAgfQogIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHsKICAgIGNvbnNvbGUubG9nKGVycik7IC8vdGhhdC5yZXF1ZXN0RmFpbGVkKGVycik7CiAgfSk7Cn0KCmZ1bmN0aW9uIGxvZ2luU3VjY2VzcyhjYWxsYmFjaykgewogIGNhbGxiYWNrKCk7Cn0KCmV4cG9ydCBkZWZhdWx0IFNTTzs="},{"version":3,"sources":["D:/vue/src/cas/sso.js"],"names":["Vue","ACCESS_TOKEN","store","init","callback","process","env","VUE_APP_SSO","console","log","token","ls","get","st","getUrlParam","sevice","window","location","host","loginSuccess","validateSt","serviceUrl","encodeURIComponent","href","_CONFIG","SSO","paraName","url","document","toString","arrObj","split","length","arrPara","arr","i","ticket","service","params","dispatch","then","res","success","catch","err"],"mappings":"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","sourcesContent":["import Vue from 'vue'\r\nimport { ACCESS_TOKEN } from \"@/store/mutation-types\"\r\nimport store from '@/store'\r\n/**\r\n * 单点登录\r\n */\r\nconst init = (callback) => {\r\n  if (process.env.VUE_APP_SSO == 'true') {\r\n    console.log(\"-------单点登录开始-------\");\r\n    let token = Vue.ls.get(ACCESS_TOKEN);\r\n    let st = getUrlParam(\"ticket\");\r\n    let sevice = \"http://\" + window.location.host + \"/\";\r\n    if (token) {\r\n      loginSuccess(callback);\r\n    } else {\r\n      if (st) {\r\n        validateSt(st, sevice, callback);\r\n      } else {\r\n        let serviceUrl = encodeURIComponent(sevice);\r\n        window.location.href = window._CONFIG['casPrefixUrl'] + \"/login?service=\" + serviceUrl;\r\n      }\r\n    }\r\n    console.log(\"-------单点登录结束-------\");\r\n  }else{\r\n    callback && callback()\r\n  }\r\n};\r\nconst SSO = {\r\n  init: init\r\n};\r\n\r\nfunction getUrlParam(paraName) {\r\n  let url = document.location.toString();\r\n  let arrObj = url.split(\"?\");\r\n\r\n  if (arrObj.length > 1) {\r\n    let arrPara = arrObj[1].split(\"&\");\r\n    let arr;\r\n\r\n    for (let i = 0; i < arrPara.length; i++) {\r\n      arr = arrPara[i].split(\"=\");\r\n\r\n      if (arr != null && arr[0] == paraName) {\r\n        return arr[1];\r\n      }\r\n    }\r\n    return \"\";\r\n  }\r\n  else {\r\n    return \"\";\r\n  }\r\n}\r\n\r\nfunction validateSt(ticket,service,callback){\r\n  let params = {\r\n    ticket: ticket,\r\n    service:service\r\n  };\r\n  store.dispatch('ValidateLogin',params).then(res => {\r\n    //this.departConfirm(res)\r\n    if(res.success){\r\n      loginSuccess(callback);\r\n    }else{\r\n      let sevice = \"http://\"+window.location.host+\"/\";\r\n      let serviceUrl = encodeURIComponent(sevice);\r\n      window.location.href = window._CONFIG['casPrefixUrl']+\"/login?service=\"+serviceUrl;\r\n    }\r\n  }).catch((err) => {\r\n    console.log(err);\r\n    //that.requestFailed(err);\r\n  });\r\n}\r\n\r\nfunction loginSuccess (callback) {\r\n  callback();\r\n}\r\nexport default SSO;"]}]}