{"remainingRequest":"D:\\vue\\node_modules\\babel-loader\\lib\\index.js!D:\\vue\\src\\store\\modules\\permission.js","dependencies":[{"path":"D:\\vue\\src\\store\\modules\\permission.js","mtime":1615948817005},{"path":"D:\\vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1615952641464},{"path":"D:\\vue\\node_modules\\babel-loader\\lib\\index.js","mtime":1615952610415}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgYXN5bmNSb3V0ZXJNYXAsIGNvbnN0YW50Um91dGVyTWFwIH0gZnJvbSAiQC9jb25maWcvcm91dGVyLmNvbmZpZyI7Ci8qKg0KICog6L+H5ruk6LSm5oi35piv5ZCm5oul5pyJ5p+Q5LiA5Liq5p2D6ZmQ77yM5bm25bCG6I+c5Y2V5LuO5Yqg6L295YiX6KGo56e76ZmkDQogKg0KICogQHBhcmFtIHBlcm1pc3Npb24NCiAqIEBwYXJhbSByb3V0ZQ0KICogQHJldHVybnMge2Jvb2xlYW59DQogKi8KCmZ1bmN0aW9uIGhhc1Blcm1pc3Npb24ocGVybWlzc2lvbiwgcm91dGUpIHsKICBpZiAocm91dGUubWV0YSAmJiByb3V0ZS5tZXRhLnBlcm1pc3Npb24pIHsKICAgIHZhciBmbGFnID0gLTE7CgogICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHBlcm1pc3Npb24ubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgZmxhZyA9IHJvdXRlLm1ldGEucGVybWlzc2lvbi5pbmRleE9mKHBlcm1pc3Npb25baV0pOwoKICAgICAgaWYgKGZsYWcgPj0gMCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgcmV0dXJuIHRydWU7Cn0KLyoqDQogKiDljZXotKbmiLflpJrop5LoibLml7bvvIzkvb/nlKjor6Xmlrnms5Xlj6/ov4fmu6Top5LoibLkuI3lrZjlnKjnmoToj5zljZUNCiAqDQogKiBAcGFyYW0gcm9sZXMNCiAqIEBwYXJhbSByb3V0ZQ0KICogQHJldHVybnMgeyp9DQogKi8KLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lCgoKZnVuY3Rpb24gaGFzUm9sZShyb2xlcywgcm91dGUpIHsKICBpZiAocm91dGUubWV0YSAmJiByb3V0ZS5tZXRhLnJvbGVzKSB7CiAgICByZXR1cm4gcm91dGUubWV0YS5yb2xlcy5pbmRleE9mKHJvbGVzLmlkKTsKICB9IGVsc2UgewogICAgcmV0dXJuIHRydWU7CiAgfQp9CgpmdW5jdGlvbiBmaWx0ZXJBc3luY1JvdXRlcihyb3V0ZXJNYXAsIHJvbGVzKSB7CiAgdmFyIGFjY2Vzc2VkUm91dGVycyA9IHJvdXRlck1hcC5maWx0ZXIoZnVuY3Rpb24gKHJvdXRlKSB7CiAgICBpZiAoaGFzUGVybWlzc2lvbihyb2xlcy5wZXJtaXNzaW9uTGlzdCwgcm91dGUpKSB7CiAgICAgIGlmIChyb3V0ZS5jaGlsZHJlbiAmJiByb3V0ZS5jaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgICByb3V0ZS5jaGlsZHJlbiA9IGZpbHRlckFzeW5jUm91dGVyKHJvdXRlLmNoaWxkcmVuLCByb2xlcyk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHJldHVybiBmYWxzZTsKICB9KTsKICByZXR1cm4gYWNjZXNzZWRSb3V0ZXJzOwp9Cgp2YXIgcGVybWlzc2lvbiA9IHsKICBzdGF0ZTogewogICAgcm91dGVyczogY29uc3RhbnRSb3V0ZXJNYXAsCiAgICBhZGRSb3V0ZXJzOiBbXQogIH0sCiAgbXV0YXRpb25zOiB7CiAgICBTRVRfUk9VVEVSUzogZnVuY3Rpb24gU0VUX1JPVVRFUlMoc3RhdGUsIGRhdGEpIHsKICAgICAgc3RhdGUuYWRkUm91dGVycyA9IGRhdGE7CiAgICAgIHN0YXRlLnJvdXRlcnMgPSBjb25zdGFudFJvdXRlck1hcC5jb25jYXQoZGF0YSk7IC8vY29uc29sZS5sb2coJy0tLS0tbXV0YXRpb25zLS0tU0VUX1JPVVRFUlMtLS0tJywgZGF0YSkKICAgIH0KICB9LAogIGFjdGlvbnM6IHsKICAgIEdlbmVyYXRlUm91dGVzOiBmdW5jdGlvbiBHZW5lcmF0ZVJvdXRlcyhfcmVmLCBkYXRhKSB7CiAgICAgIHZhciBjb21taXQgPSBfcmVmLmNvbW1pdDsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgdmFyIHJvbGVzID0gZGF0YS5yb2xlczsKICAgICAgICBjb25zb2xlLmxvZygnLS0tLS1tdXRhdGlvbnMtLS1kYXRhLS0tLScsIGRhdGEpOwogICAgICAgIHZhciBhY2Nlc3NlZFJvdXRlcnM7CiAgICAgICAgYWNjZXNzZWRSb3V0ZXJzID0gZmlsdGVyQXN5bmNSb3V0ZXIoYXN5bmNSb3V0ZXJNYXAsIHJvbGVzKTsKICAgICAgICBjb25zb2xlLmxvZygnLS0tLS1tdXRhdGlvbnMtLS1hY2Nlc3NlZFJvdXRlcnMtLS0tJywgYWNjZXNzZWRSb3V0ZXJzKTsKICAgICAgICBjb21taXQoJ1NFVF9ST1VURVJTJywgYWNjZXNzZWRSb3V0ZXJzKTsKICAgICAgICByZXNvbHZlKCk7CiAgICAgIH0pOwogICAgfSwKICAgIC8vIOWKqOaAgea3u+WKoOS4u+eVjOmdoui3r+eUse+8jOmcgOimgee8k+WtmAogICAgVXBkYXRlQXBwUm91dGVyOiBmdW5jdGlvbiBVcGRhdGVBcHBSb3V0ZXIoX3JlZjIsIHJvdXRlcykgewogICAgICB2YXIgY29tbWl0ID0gX3JlZjIuY29tbWl0OwogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICAvL2NvbnN0IFsgcm9sZXMgXSA9IHJvdXRlcy5jb25zdFJvdXRlcwogICAgICAgIHZhciByb3V0ZWxpc3QgPSByb3V0ZXMuY29uc3RSb3V0ZXM7CiAgICAgICAgY29tbWl0KCdTRVRfUk9VVEVSUycsIHJvdXRlbGlzdCk7CiAgICAgICAgcmVzb2x2ZSgpOwogICAgICB9KTsKICAgIH0KICB9Cn07CmV4cG9ydCBkZWZhdWx0IHBlcm1pc3Npb247"},{"version":3,"sources":["D:/vue/src/store/modules/permission.js"],"names":["asyncRouterMap","constantRouterMap","hasPermission","permission","route","meta","flag","i","len","length","indexOf","hasRole","roles","id","filterAsyncRouter","routerMap","accessedRouters","filter","permissionList","children","state","routers","addRouters","mutations","SET_ROUTERS","data","concat","actions","GenerateRoutes","commit","Promise","resolve","console","log","UpdateAppRouter","routes","routelist","constRoutes"],"mappings":"AAAA,SAASA,cAAT,EAAyBC,iBAAzB,QAAkD,wBAAlD;AAEA;;;;;;;;AAOA,SAASC,aAAT,CAAuBC,UAAvB,EAAmCC,KAAnC,EAA0C;AACxC,MAAIA,KAAK,CAACC,IAAN,IAAcD,KAAK,CAACC,IAAN,CAAWF,UAA7B,EAAyC;AACvC,QAAIG,IAAI,GAAG,CAAC,CAAZ;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGL,UAAU,CAACM,MAAjC,EAAyCF,CAAC,GAAGC,GAA7C,EAAkDD,CAAC,EAAnD,EAAuD;AACrDD,MAAAA,IAAI,GAAGF,KAAK,CAACC,IAAN,CAAWF,UAAX,CAAsBO,OAAtB,CAA8BP,UAAU,CAACI,CAAD,CAAxC,CAAP;;AACA,UAAID,IAAI,IAAI,CAAZ,EAAe;AACb,eAAO,IAAP;AACD;AACF;;AACD,WAAO,KAAP;AACD;;AACD,SAAO,IAAP;AACD;AAED;;;;;;;AAOA;;;AACA,SAASK,OAAT,CAAiBC,KAAjB,EAAwBR,KAAxB,EAA+B;AAC7B,MAAIA,KAAK,CAACC,IAAN,IAAcD,KAAK,CAACC,IAAN,CAAWO,KAA7B,EAAoC;AAClC,WAAOR,KAAK,CAACC,IAAN,CAAWO,KAAX,CAAiBF,OAAjB,CAAyBE,KAAK,CAACC,EAA/B,CAAP;AACD,GAFD,MAEO;AACL,WAAO,IAAP;AACD;AACF;;AAED,SAASC,iBAAT,CAA2BC,SAA3B,EAAsCH,KAAtC,EAA6C;AAC3C,MAAMI,eAAe,GAAGD,SAAS,CAACE,MAAV,CAAiB,UAAAb,KAAK,EAAI;AAChD,QAAIF,aAAa,CAACU,KAAK,CAACM,cAAP,EAAuBd,KAAvB,CAAjB,EAAgD;AAC9C,UAAIA,KAAK,CAACe,QAAN,IAAkBf,KAAK,CAACe,QAAN,CAAeV,MAArC,EAA6C;AAC3CL,QAAAA,KAAK,CAACe,QAAN,GAAiBL,iBAAiB,CAACV,KAAK,CAACe,QAAP,EAAiBP,KAAjB,CAAlC;AACD;;AACD,aAAO,IAAP;AACD;;AACD,WAAO,KAAP;AACD,GARuB,CAAxB;AASA,SAAOI,eAAP;AACD;;AAGD,IAAMb,UAAU,GAAG;AACjBiB,EAAAA,KAAK,EAAE;AACLC,IAAAA,OAAO,EAAEpB,iBADJ;AAELqB,IAAAA,UAAU,EAAE;AAFP,GADU;AAKjBC,EAAAA,SAAS,EAAE;AACTC,IAAAA,WAAW,EAAE,qBAACJ,KAAD,EAAQK,IAAR,EAAiB;AAC5BL,MAAAA,KAAK,CAACE,UAAN,GAAmBG,IAAnB;AACAL,MAAAA,KAAK,CAACC,OAAN,GAAgBpB,iBAAiB,CAACyB,MAAlB,CAAyBD,IAAzB,CAAhB,CAF4B,CAG5B;AACD;AALQ,GALM;AAYjBE,EAAAA,OAAO,EAAE;AACPC,IAAAA,cADO,gCACoBH,IADpB,EAC0B;AAAA,UAAhBI,MAAgB,QAAhBA,MAAgB;AAC/B,aAAO,IAAIC,OAAJ,CAAY,UAAAC,OAAO,EAAI;AAAA,YACpBnB,KADoB,GACVa,IADU,CACpBb,KADoB;AAE5BoB,QAAAA,OAAO,CAACC,GAAR,CAAY,2BAAZ,EAAyCR,IAAzC;AACA,YAAIT,eAAJ;AACAA,QAAAA,eAAe,GAAGF,iBAAiB,CAACd,cAAD,EAAiBY,KAAjB,CAAnC;AACAoB,QAAAA,OAAO,CAACC,GAAR,CAAY,sCAAZ,EAAoDjB,eAApD;AACAa,QAAAA,MAAM,CAAC,aAAD,EAAgBb,eAAhB,CAAN;AACAe,QAAAA,OAAO;AACR,OARM,CAAP;AASD,KAXM;AAYP;AACAG,IAAAA,eAbO,kCAaqBC,MAbrB,EAa6B;AAAA,UAAlBN,MAAkB,SAAlBA,MAAkB;AAClC,aAAO,IAAIC,OAAJ,CAAY,UAAAC,OAAO,EAAI;AAC5B;AACA,YAAIK,SAAS,GAAGD,MAAM,CAACE,WAAvB;AACAR,QAAAA,MAAM,CAAC,aAAD,EAAgBO,SAAhB,CAAN;AACAL,QAAAA,OAAO;AACR,OALM,CAAP;AAMD;AApBM;AAZQ,CAAnB;AAoCA,eAAe5B,UAAf","sourcesContent":["import { asyncRouterMap, constantRouterMap } from \"@/config/router.config\"\r\n\r\n/**\r\n * 过滤账户是否拥有某一个权限，并将菜单从加载列表移除\r\n *\r\n * @param permission\r\n * @param route\r\n * @returns {boolean}\r\n */\r\nfunction hasPermission(permission, route) {\r\n  if (route.meta && route.meta.permission) {\r\n    let flag = -1\r\n    for (let i = 0, len = permission.length; i < len; i++) {\r\n      flag = route.meta.permission.indexOf(permission[i])\r\n      if (flag >= 0) {\r\n        return true\r\n      }\r\n    }\r\n    return false\r\n  }\r\n  return true\r\n}\r\n\r\n/**\r\n * 单账户多角色时，使用该方法可过滤角色不存在的菜单\r\n *\r\n * @param roles\r\n * @param route\r\n * @returns {*}\r\n */\r\n// eslint-disable-next-line\r\nfunction hasRole(roles, route) {\r\n  if (route.meta && route.meta.roles) {\r\n    return route.meta.roles.indexOf(roles.id)\r\n  } else {\r\n    return true\r\n  }\r\n}\r\n\r\nfunction filterAsyncRouter(routerMap, roles) {\r\n  const accessedRouters = routerMap.filter(route => {\r\n    if (hasPermission(roles.permissionList, route)) {\r\n      if (route.children && route.children.length) {\r\n        route.children = filterAsyncRouter(route.children, roles)\r\n      }\r\n      return true\r\n    }\r\n    return false\r\n  })\r\n  return accessedRouters\r\n}\r\n\r\n\r\nconst permission = {\r\n  state: {\r\n    routers: constantRouterMap,\r\n    addRouters: []\r\n  },\r\n  mutations: {\r\n    SET_ROUTERS: (state, data) => {\r\n      state.addRouters = data\r\n      state.routers = constantRouterMap.concat(data)\r\n      //console.log('-----mutations---SET_ROUTERS----', data)\r\n    }\r\n  },\r\n  actions: {\r\n    GenerateRoutes({ commit }, data) {\r\n      return new Promise(resolve => {\r\n        const { roles } = data\r\n        console.log('-----mutations---data----', data)\r\n        let accessedRouters\r\n        accessedRouters = filterAsyncRouter(asyncRouterMap, roles)\r\n        console.log('-----mutations---accessedRouters----', accessedRouters)\r\n        commit('SET_ROUTERS', accessedRouters)\r\n        resolve()\r\n      })\r\n    },\r\n    // 动态添加主界面路由，需要缓存\r\n    UpdateAppRouter({ commit }, routes) {\r\n      return new Promise(resolve => {\r\n        //const [ roles ] = routes.constRoutes\r\n        let routelist = routes.constRoutes;\r\n        commit('SET_ROUTERS', routelist)\r\n        resolve()\r\n      })\r\n    }\r\n  }\r\n}\r\n\r\nexport default permission"]}]}