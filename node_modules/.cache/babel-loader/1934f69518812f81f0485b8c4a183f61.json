{"remainingRequest":"D:\\vue\\node_modules\\babel-loader\\lib\\index.js!D:\\vue\\src\\permission.js","dependencies":[{"path":"D:\\vue\\src\\permission.js","mtime":1615948822867},{"path":"D:\\vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\vue\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:ZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pOyBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpZiAoaSAlIDIpIHsgb3duS2V5cyhPYmplY3Qoc291cmNlKSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOyB9KTsgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgeyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOyB9IGVsc2UgeyBvd25LZXlzKE9iamVjdChzb3VyY2UpKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IH0gcmV0dXJuIHRhcmdldDsgfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgeyBpZiAoa2V5IGluIG9iaikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pOyB9IGVsc2UgeyBvYmpba2V5XSA9IHZhbHVlOyB9IHJldHVybiBvYmo7IH0KCmltcG9ydCBWdWUgZnJvbSAndnVlJzsKaW1wb3J0IHJvdXRlciBmcm9tICcuL3JvdXRlcic7CmltcG9ydCBzdG9yZSBmcm9tICcuL3N0b3JlJzsKaW1wb3J0IE5Qcm9ncmVzcyBmcm9tICducHJvZ3Jlc3MnOyAvLyBwcm9ncmVzcyBiYXIKCmltcG9ydCAnbnByb2dyZXNzL25wcm9ncmVzcy5jc3MnOyAvLyBwcm9ncmVzcyBiYXIgc3R5bGUKCmltcG9ydCBub3RpZmljYXRpb24gZnJvbSAnYW50LWRlc2lnbi12dWUvZXMvbm90aWZpY2F0aW9uJzsKaW1wb3J0IHsgQUNDRVNTX1RPS0VOLCBJTkRFWF9NQUlOX1BBR0VfUEFUSCB9IGZyb20gJ0Avc3RvcmUvbXV0YXRpb24tdHlwZXMnOwppbXBvcnQgeyBnZW5lcmF0ZUluZGV4Um91dGVyIH0gZnJvbSAiQC91dGlscy91dGlsIjsKTlByb2dyZXNzLmNvbmZpZ3VyZSh7CiAgc2hvd1NwaW5uZXI6IGZhbHNlCn0pOyAvLyBOUHJvZ3Jlc3MgQ29uZmlndXJhdGlvbgoKdmFyIHdoaXRlTGlzdCA9IFsnL3VzZXIvbG9naW4nLCAnL3VzZXIvcmVnaXN0ZXInLCAnL3VzZXIvcmVnaXN0ZXItcmVzdWx0JywgJy91c2VyL2FsdGVyYXRpb24nXTsgLy8gbm8gcmVkaXJlY3Qgd2hpdGVsaXN0Cgpyb3V0ZXIuYmVmb3JlRWFjaChmdW5jdGlvbiAodG8sIGZyb20sIG5leHQpIHsKICBOUHJvZ3Jlc3Muc3RhcnQoKTsgLy8gc3RhcnQgcHJvZ3Jlc3MgYmFyCgogIGlmIChWdWUubHMuZ2V0KEFDQ0VTU19UT0tFTikpIHsKICAgIC8qIGhhcyB0b2tlbiAqLwogICAgaWYgKHRvLnBhdGggPT09ICcvdXNlci9sb2dpbicpIHsKICAgICAgbmV4dCh7CiAgICAgICAgcGF0aDogSU5ERVhfTUFJTl9QQUdFX1BBVEgKICAgICAgfSk7CiAgICAgIE5Qcm9ncmVzcy5kb25lKCk7CiAgICB9IGVsc2UgewogICAgICBpZiAoc3RvcmUuZ2V0dGVycy5wZXJtaXNzaW9uTGlzdC5sZW5ndGggPT09IDApIHsKICAgICAgICBzdG9yZS5kaXNwYXRjaCgnR2V0UGVybWlzc2lvbkxpc3QnKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgIHZhciBtZW51RGF0YSA9IHJlcy5yZXN1bHQubWVudTsgLy9jb25zb2xlLmxvZyhyZXMubWVzc2FnZSkKCiAgICAgICAgICBpZiAobWVudURhdGEgPT09IG51bGwgfHwgbWVudURhdGEgPT09ICIiIHx8IG1lbnVEYXRhID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBjb25zdFJvdXRlcyA9IFtdOwogICAgICAgICAgY29uc3RSb3V0ZXMgPSBnZW5lcmF0ZUluZGV4Um91dGVyKG1lbnVEYXRhKTsgLy8g5re75Yqg5Li755WM6Z2i6Lev55SxCgogICAgICAgICAgc3RvcmUuZGlzcGF0Y2goJ1VwZGF0ZUFwcFJvdXRlcicsIHsKICAgICAgICAgICAgY29uc3RSb3V0ZXM6IGNvbnN0Um91dGVzCiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgLy8g5qC55o2ucm9sZXPmnYPpmZDnlJ/miJDlj6/orr/pl67nmoTot6/nlLHooagKICAgICAgICAgICAgLy8g5Yqo5oCB5re75Yqg5Y+v6K6/6Zeu6Lev55Sx6KGoCiAgICAgICAgICAgIHJvdXRlci5hZGRSb3V0ZXMoc3RvcmUuZ2V0dGVycy5hZGRSb3V0ZXJzKTsKICAgICAgICAgICAgdmFyIHJlZGlyZWN0ID0gZGVjb2RlVVJJQ29tcG9uZW50KGZyb20ucXVlcnkucmVkaXJlY3QgfHwgdG8ucGF0aCk7CgogICAgICAgICAgICBpZiAodG8ucGF0aCA9PT0gcmVkaXJlY3QpIHsKICAgICAgICAgICAgICAvLyBoYWNr5pa55rOVIOehruS/nWFkZFJvdXRlc+W3suWujOaIkCAsc2V0IHRoZSByZXBsYWNlOiB0cnVlIHNvIHRoZSBuYXZpZ2F0aW9uIHdpbGwgbm90IGxlYXZlIGEgaGlzdG9yeSByZWNvcmQKICAgICAgICAgICAgICBuZXh0KF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgdG8pLCB7fSwgewogICAgICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZQogICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvLyDot7PovazliLDnm67nmoTot6/nlLEKICAgICAgICAgICAgICBuZXh0KHsKICAgICAgICAgICAgICAgIHBhdGg6IHJlZGlyZWN0CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIC8qIG5vdGlmaWNhdGlvbi5lcnJvcih7DQogICAgICAgICAgICAgbWVzc2FnZTogJ+ezu+e7n+aPkOekuicsDQogICAgICAgICAgICAgZGVzY3JpcHRpb246ICfor7fmsYLnlKjmiLfkv6Hmga/lpLHotKXvvIzor7fph43or5XvvIEnDQogICAgICAgICAgIH0pKi8KICAgICAgICAgIHN0b3JlLmRpc3BhdGNoKCdMb2dvdXQnKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgbmV4dCh7CiAgICAgICAgICAgICAgcGF0aDogJy91c2VyL2xvZ2luJywKICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgcmVkaXJlY3Q6IHRvLmZ1bGxQYXRoCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIG5leHQoKTsKICAgICAgfQogICAgfQogIH0gZWxzZSB7CiAgICBpZiAod2hpdGVMaXN0LmluZGV4T2YodG8ucGF0aCkgIT09IC0xKSB7CiAgICAgIC8vIOWcqOWFjeeZu+W9leeZveWQjeWNle+8jOebtOaOpei/m+WFpQogICAgICBuZXh0KCk7CiAgICB9IGVsc2UgewogICAgICBuZXh0KHsKICAgICAgICBwYXRoOiAnL3VzZXIvbG9naW4nLAogICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICByZWRpcmVjdDogdG8uZnVsbFBhdGgKICAgICAgICB9CiAgICAgIH0pOwogICAgICBOUHJvZ3Jlc3MuZG9uZSgpOyAvLyBpZiBjdXJyZW50IHBhZ2UgaXMgbG9naW4gd2lsbCBub3QgdHJpZ2dlciBhZnRlckVhY2ggaG9vaywgc28gbWFudWFsbHkgaGFuZGxlIGl0CiAgICB9CiAgfQp9KTsKcm91dGVyLmFmdGVyRWFjaChmdW5jdGlvbiAoKSB7CiAgTlByb2dyZXNzLmRvbmUoKTsgLy8gZmluaXNoIHByb2dyZXNzIGJhcgp9KTs="},{"version":3,"sources":["D:/vue/src/permission.js"],"names":["Vue","router","store","NProgress","notification","ACCESS_TOKEN","INDEX_MAIN_PAGE_PATH","generateIndexRouter","configure","showSpinner","whiteList","beforeEach","to","from","next","start","ls","get","path","done","getters","permissionList","length","dispatch","then","res","menuData","result","menu","undefined","constRoutes","addRoutes","addRouters","redirect","decodeURIComponent","query","replace","catch","fullPath","indexOf","afterEach"],"mappings":";;;;;;AAAA,OAAOA,GAAP,MAAgB,KAAhB;AACA,OAAOC,MAAP,MAAmB,UAAnB;AACA,OAAOC,KAAP,MAAkB,SAAlB;AACA,OAAOC,SAAP,MAAsB,WAAtB,C,CAAkC;;AAClC,OAAO,yBAAP,C,CAAiC;;AACjC,OAAOC,YAAP,MAAyB,gCAAzB;AACA,SAASC,YAAT,EAAsBC,oBAAtB,QAAkD,wBAAlD;AACA,SAASC,mBAAT,QAAoC,cAApC;AAEAJ,SAAS,CAACK,SAAV,CAAoB;AAAEC,EAAAA,WAAW,EAAE;AAAf,CAApB,E,CAA4C;;AAE5C,IAAMC,SAAS,GAAG,CAAC,aAAD,EAAgB,gBAAhB,EAAkC,uBAAlC,EAA0D,kBAA1D,CAAlB,C,CAAgG;;AAEhGT,MAAM,CAACU,UAAP,CAAkB,UAACC,EAAD,EAAKC,IAAL,EAAWC,IAAX,EAAoB;AACpCX,EAAAA,SAAS,CAACY,KAAV,GADoC,CAClB;;AAElB,MAAIf,GAAG,CAACgB,EAAJ,CAAOC,GAAP,CAAWZ,YAAX,CAAJ,EAA8B;AAC5B;AACA,QAAIO,EAAE,CAACM,IAAH,KAAY,aAAhB,EAA+B;AAC7BJ,MAAAA,IAAI,CAAC;AAAEI,QAAAA,IAAI,EAAEZ;AAAR,OAAD,CAAJ;AACAH,MAAAA,SAAS,CAACgB,IAAV;AACD,KAHD,MAGO;AACL,UAAIjB,KAAK,CAACkB,OAAN,CAAcC,cAAd,CAA6BC,MAA7B,KAAwC,CAA5C,EAA+C;AAC7CpB,QAAAA,KAAK,CAACqB,QAAN,CAAe,mBAAf,EAAoCC,IAApC,CAAyC,UAAAC,GAAG,EAAI;AAC1C,cAAMC,QAAQ,GAAGD,GAAG,CAACE,MAAJ,CAAWC,IAA5B,CAD0C,CAE1C;;AACA,cAAIF,QAAQ,KAAK,IAAb,IAAqBA,QAAQ,KAAK,EAAlC,IAAwCA,QAAQ,KAAKG,SAAzD,EAAoE;AAClE;AACD;;AACD,cAAIC,WAAW,GAAG,EAAlB;AACAA,UAAAA,WAAW,GAAGvB,mBAAmB,CAACmB,QAAD,CAAjC,CAP0C,CAQ1C;;AACAxB,UAAAA,KAAK,CAACqB,QAAN,CAAe,iBAAf,EAAmC;AAAEO,YAAAA,WAAW,EAAXA;AAAF,WAAnC,EAAoDN,IAApD,CAAyD,YAAM;AAC7D;AACA;AACAvB,YAAAA,MAAM,CAAC8B,SAAP,CAAiB7B,KAAK,CAACkB,OAAN,CAAcY,UAA/B;AACA,gBAAMC,QAAQ,GAAGC,kBAAkB,CAACrB,IAAI,CAACsB,KAAL,CAAWF,QAAX,IAAuBrB,EAAE,CAACM,IAA3B,CAAnC;;AACA,gBAAIN,EAAE,CAACM,IAAH,KAAYe,QAAhB,EAA0B;AACxB;AACAnB,cAAAA,IAAI,iCAAMF,EAAN;AAAUwB,gBAAAA,OAAO,EAAE;AAAnB,iBAAJ;AACD,aAHD,MAGO;AACL;AACAtB,cAAAA,IAAI,CAAC;AAAEI,gBAAAA,IAAI,EAAEe;AAAR,eAAD,CAAJ;AACD;AACF,WAZD;AAaD,SAtBL,EAuBGI,KAvBH,CAuBS,YAAM;AACZ;;;;AAICnC,UAAAA,KAAK,CAACqB,QAAN,CAAe,QAAf,EAAyBC,IAAzB,CAA8B,YAAM;AAClCV,YAAAA,IAAI,CAAC;AAAEI,cAAAA,IAAI,EAAE,aAAR;AAAuBiB,cAAAA,KAAK,EAAE;AAAEF,gBAAAA,QAAQ,EAAErB,EAAE,CAAC0B;AAAf;AAA9B,aAAD,CAAJ;AACD,WAFD;AAGD,SA/BH;AAgCD,OAjCD,MAiCO;AACLxB,QAAAA,IAAI;AACL;AACF;AACF,GA3CD,MA2CO;AACL,QAAIJ,SAAS,CAAC6B,OAAV,CAAkB3B,EAAE,CAACM,IAArB,MAA+B,CAAC,CAApC,EAAuC;AACrC;AACAJ,MAAAA,IAAI;AACL,KAHD,MAGO;AACLA,MAAAA,IAAI,CAAC;AAAEI,QAAAA,IAAI,EAAE,aAAR;AAAuBiB,QAAAA,KAAK,EAAE;AAAEF,UAAAA,QAAQ,EAAErB,EAAE,CAAC0B;AAAf;AAA9B,OAAD,CAAJ;AACAnC,MAAAA,SAAS,CAACgB,IAAV,GAFK,CAEY;AAClB;AACF;AACF,CAvDD;AAyDAlB,MAAM,CAACuC,SAAP,CAAiB,YAAM;AACrBrC,EAAAA,SAAS,CAACgB,IAAV,GADqB,CACJ;AAClB,CAFD","sourcesContent":["import Vue from 'vue'\r\nimport router from './router'\r\nimport store from './store'\r\nimport NProgress from 'nprogress' // progress bar\r\nimport 'nprogress/nprogress.css' // progress bar style\r\nimport notification from 'ant-design-vue/es/notification'\r\nimport { ACCESS_TOKEN,INDEX_MAIN_PAGE_PATH } from '@/store/mutation-types'\r\nimport { generateIndexRouter } from \"@/utils/util\"\r\n\r\nNProgress.configure({ showSpinner: false }) // NProgress Configuration\r\n\r\nconst whiteList = ['/user/login', '/user/register', '/user/register-result','/user/alteration'] // no redirect whitelist\r\n\r\nrouter.beforeEach((to, from, next) => {\r\n  NProgress.start() // start progress bar\r\n\r\n  if (Vue.ls.get(ACCESS_TOKEN)) {\r\n    /* has token */\r\n    if (to.path === '/user/login') {\r\n      next({ path: INDEX_MAIN_PAGE_PATH })\r\n      NProgress.done()\r\n    } else {\r\n      if (store.getters.permissionList.length === 0) {\r\n        store.dispatch('GetPermissionList').then(res => {\r\n              const menuData = res.result.menu;\r\n              //console.log(res.message)\r\n              if (menuData === null || menuData === \"\" || menuData === undefined) {\r\n                return;\r\n              }\r\n              let constRoutes = [];\r\n              constRoutes = generateIndexRouter(menuData);\r\n              // 添加主界面路由\r\n              store.dispatch('UpdateAppRouter',  { constRoutes }).then(() => {\r\n                // 根据roles权限生成可访问的路由表\r\n                // 动态添加可访问路由表\r\n                router.addRoutes(store.getters.addRouters)\r\n                const redirect = decodeURIComponent(from.query.redirect || to.path)\r\n                if (to.path === redirect) {\r\n                  // hack方法 确保addRoutes已完成 ,set the replace: true so the navigation will not leave a history record\r\n                  next({ ...to, replace: true })\r\n                } else {\r\n                  // 跳转到目的路由\r\n                  next({ path: redirect })\r\n                }\r\n              })\r\n            })\r\n          .catch(() => {\r\n           /* notification.error({\r\n              message: '系统提示',\r\n              description: '请求用户信息失败，请重试！'\r\n            })*/\r\n            store.dispatch('Logout').then(() => {\r\n              next({ path: '/user/login', query: { redirect: to.fullPath } })\r\n            })\r\n          })\r\n      } else {\r\n        next()\r\n      }\r\n    }\r\n  } else {\r\n    if (whiteList.indexOf(to.path) !== -1) {\r\n      // 在免登录白名单，直接进入\r\n      next()\r\n    } else {\r\n      next({ path: '/user/login', query: { redirect: to.fullPath } })\r\n      NProgress.done() // if current page is login will not trigger afterEach hook, so manually handle it\r\n    }\r\n  }\r\n})\r\n\r\nrouter.afterEach(() => {\r\n  NProgress.done() // finish progress bar\r\n})\r\n"]}]}